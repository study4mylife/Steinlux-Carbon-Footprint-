<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>æ—…éŠæ¸¬è©¦æ¨¡æ¿</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/all.css" />
    <link rel="stylesheet" href="css/story.css" />
    <style>
      .hidden {
        display: none;
      }
      .inactive {
        opacity: 0.4;
      }

      /* ---------------------------------------
       4. äº¤é€šå·¥å…·é¸å–®
    --------------------------------------- */
      .transport-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(120px, 1fr));
        grid-template-rows: repeat(2, auto);
        gap: 1rem;
        width: 90%;
        max-width: 700px;
        margin: 0 auto;
      }
      .transport-card {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: rgba(255, 255, 255, 0);
        border-radius: 32px;
        cursor: pointer;
        transition: transform 0.2s, border-color 0.2s;
      }
      .transport-card img {
        width: 120px;
        height: 120px;
        object-fit: contain;
        margin-bottom: -10px;
      }

      .transport-card .label {
        font-family: "GenSenRounded2TW-R", sans-serif;
        font-size: 1.2rem;
        color: #6d808f;
        text-align: center;
        white-space: nowrap;
        letter-spacing: 6px;
      }

      .transport-card:hover {
        transform: translateY(-2px);
      }
      
      .transport-card.selected {
      -webkit-box-shadow:
      inset -8.25px -2.25px 0 -6.75px rgb(255, 255, 255), 
      inset 8.25px 2.25px 0 -6.75px rgb(255, 255, 255),
      inset -2.75px -8px 0 -7px rgb(255, 255, 255), 
      inset 2.75px 8px 0 -7px rgb(255, 255, 255),
      0 0 0 0.2px rgb(255, 255, 255),
      2px 2px 16px 4px rgba(110, 110, 110, 0.15);
      box-shadow:
      inset -8.25px -2.25px 0 -6.75px rgb(255, 255, 255), 
      inset 8.25px 2.25px 0 -6.75px rgb(255, 255, 255),
      inset -2.75px -8.25px 0 -7px rgb(255, 255, 255), 
      inset 2.75px 8.25px 0 -7px rgb(255, 255, 255),
      0 0 0 0.2px rgb(255, 255, 255),
      2px 2px 12px 4px rgba(110, 110, 110, 0.15);
      }

      /* ---------------------------------------
       5. åˆ‡æ›é–‹é—œå€å¡Š (Scene 2 & 4)
    --------------------------------------- */
      .toggle-row {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
      }

      .travel-card {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        width: 100%;
        gap: 32px;
      }

      .toggle-card {
        display: flex;
        align-items: center;
        width: 40%;
        background: rgba(245, 245, 245, 0.1);
        border-radius: 16px;
        padding: 24px;
        gap: 16px;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .toggle-card::before {
      content: "";
      position: absolute;
      inset: 0;
      -webkit-box-shadow:
      inset -8.5px -2.25px 0 -6.75px rgb(255, 255, 255), 
      inset 8.5px 2.25px 0 -6.75px rgb(255, 255, 255),
      inset -2.75px -8.5px 0 -7px rgb(255, 255, 255), 
      inset 2.75px 8.5px 0 -7px rgb(255, 255, 255),
      0 0 0 0.2px rgb(255, 255, 255),
      2px 2px 16px 4px rgba(110, 110, 110, 0.15);
      box-shadow:
      inset -8.5px -2.25px 0 -6.75px rgb(255, 255, 255), 
      inset 8.5px 2.25px 0 -6.75px rgb(255, 255, 255),
      inset -2.75px -8.5px 0 -7px rgb(255, 255, 255), 
      inset 2.75px 8.5px 0 -7px rgb(255, 255, 255),
      0 0 0 0.2px rgb(255, 255, 255),
      2px 2px 16px 4px rgba(110, 110, 110, 0.15);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: -1;
      border-radius: 32px;
      }

      .toggle-card span.label {
        font-family: "GenSenRounded2TW-R", sans-serif;
        color: #9c7a5c;
        line-height: 1.2;
        white-space: nowrap;
      }

      .nowrap-text {
        color: #6c808f;
        white-space: nowrap;
        font-family: "GenSenRounded2TW-L", sans-serif;
        letter-spacing: 6px;
      }

    .simple-toggle {
      display: flex;
      align-items: center;
      gap: 10px;
      background: none;
      border: none;
      box-shadow: none;
      padding: 0;
    }

    .simple-toggle .nowrap-text {
      color: #9c7a5c;
    }

      /* ---------------------------------------
       6. å‹•æ…‹æ¨¡æ¿å€åŸŸ (Scene 2 & 4)
    --------------------------------------- */
      .template-wrapper {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      width: 40%;
      background: rgba(245, 245, 245, 0.1);
      border-radius: 32px;
      padding: 24px;
      gap: 16px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      }

      .template-wrapper::before {
      content: "";
      position: absolute;
      inset: 0;
      -webkit-box-shadow:
      inset -8.5px -2.25px 0 -6.75px rgb(255, 255, 255), 
      inset 8.5px 2.25px 0 -6.75px rgb(255, 255, 255),
      inset -2.75px -8.5px 0 -7px rgb(255, 255, 255), 
      inset 2.75px 8.5px 0 -7px rgb(255, 255, 255),
      0 0 0 0.2px rgb(255, 255, 255),
      2px 2px 16px 4px rgba(110, 110, 110, 0.15);
      box-shadow:
      inset -8.5px -2.25px 0 -6.75px rgb(255, 255, 255), 
      inset 8.5px 2.25px 0 -6.75px rgb(255, 255, 255),
      inset -2.75px -8.5px 0 -7px rgb(255, 255, 255), 
      inset 2.75px 8.5px 0 -7px rgb(255, 255, 255),
      0 0 0 0.2px rgb(255, 255, 255),
      2px 2px 16px 4px rgba(110, 110, 110, 0.15);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: -1;
      border-radius: 32px;
      }
      
      .template-row {
        display: flex;
        justify-content: center;
        width: 100%;
        gap: 32px;
      }

      .fuel-group .input-group {
        display: flex;
        align-items: center;
        padding: 16px 0;
        gap: 8px;
      }

      .fuel-group .input-group label {
        margin: 5px 12px;
        font-size: 1rem;
        color: #9c7a5c;
        font-family: "GenSenRounded2TW-R", sans-serif;
        letter-spacing: 4px;
        white-space: nowrap;
      }

      .fuel-group .input-group input {
        width: 100px;
        padding: 8px 10px;
        border: 0.25pt solid #b5c1c623;
        border-radius: 8px;
        box-shadow: inset 2pt 2pt 7pt #6d808f70;
        background: #fff;
        font-size: 14px;
        color: #4a4a4a;
      }

      .fuel-group .input-group input[type="number"]::-webkit-outer-spin-button,
      .fuel-group .input-group input[type="number"]::-webkit-inner-spin-button,
      .input-group-MRT input[type="number"]::-webkit-outer-spin-button,
      .input-group-MRT input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      .fuel-group .input-group select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        width: 120px;
        padding: 8px 30px 8px 12px;
        border: 0.25pt solid #b5c1c623;
        border-radius: 8px;
        box-shadow: inset 2pt 2pt 7pt #6d808f70;
        background: #fff url("images/ä¸‹æ‹‰å¼ç®­é ­.png") no-repeat right center;
        background-size: 30px;
        font-size: 14px;
        color: #4a4a4a;
        font-family: "GenSenRounded2TW-L", sans-serif;
        letter-spacing: 3px;
      }

      .fuel-group .input-group .special-label {
      font-family: "GenSenRounded2TW-L", sans-serif;
      font-weight: normal;
      color: #6c808f;
      margin: 0;
      }
      /* ---------------------------------------
       7. MRTå€åŸŸ (Scene 2 & 4)
    --------------------------------------- */

      .mrt-trip-list-wrapper .mrt-btn {
        flex: 0 0 auto; /* æŒ‰éˆ•ä¸è·Ÿè‘—æ»¾å‹•å€ç¸®æ”¾ */
        margin-top: 20px;
        align-self: flex-end;
      }
      .input-group-MRT {
        display: flex;
        align-items: center;
        flex-direction: row;
        gap: 10px;
      }
      .input-group-MRT label {
        font-size: 0.85rem;
        color: #9c7a5c;
        white-space: nowrap;
        font-family: "GenSenRounded2TW-R", sans-serif;
        letter-spacing: 6px;
      }
      .input-group-MRT .special-label {
        font-family: "GenSenRounded2TW-L", sans-serif;
        font-weight: normal;
        color: #6c808f;
        margin: 0;
      }

      .input-group-MRT select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        width: 100px;
        padding: 8px 30px 8px 12px;
        border: 1px solid rgba(208, 210, 214, 0.6);
        border-radius: 6px;
        background: #fff url("images/ä¸‹æ‹‰å¼ç®­é ­.png") no-repeat right center;
        background-size: 30px;
        box-shadow: inset 2pt 2pt 7pt #6d808f70;
        font-size: 14px;
        color: #4a4a4a;
      }

      .input-group-MRT input {
        width: 120px;
        padding: 8px 12px;
        border: 0.25pt solid #b5c1c623;
        border-radius: 6px;
        background: #fff;
        font-size: 14px;
        color: #4a4a4a;
        box-shadow: inset 2pt 2pt 7pt #6d808f70;
        font-family: "GenSenRounded2TW-L", sans-serif;
        letter-spacing: 2px;
      }

      #scene-travel-2-3 .hidden {
        display: none !important;
      }
      #scene-travel-2-3 #flight-time-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        overflow-y: auto;
        padding: 24px;
        margin: auto 0;
      }
      
      
      /* trip-list */
      .trip-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        font-size: 0.9rem;
        color: #222;
      }
      .add-trip-wrapper {
        display: flex;
        flex-direction: column;
      }
      /* 2) æ¨æŒ‰éˆ•åˆ°åº•éƒ¨ï¼Œä¸¦ç½®ä¸­ */
      .add-trip-wrapper .mrt-btn {
        margin-top: auto;
        align-self: center;
      }
      .mrt-btn {
        width: 80%;
        margin: 0 auto;
        /* èƒŒæ™¯è‰²èˆ‡åŠé€æ˜æ¯›ç»ç’ƒæ„Ÿ */
        background: rgba(240, 244, 252, 0.8);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        /* é‚Šæ¡†ã€é™°å½±ã€åœ“è§’ */
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        border-radius: 32px;
        /* æ–‡å­—å¤§å°ã€é¡è‰²ã€é™°å½± */
        font-size: 0.85rem;
        font-weight: bold;
        color: rgba(0, 0, 0, 0.2);
        text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        /* å…§é‚Šè· & æ¸¸æ¨™ */
        padding: 6px 12px;
        cursor: pointer;
        transition: background 0.2s, box-shadow 0.2s;
        font-family: "GenSenRounded2TW-R", sans-serif;
      }

      /* 2. æ»‘é¼ æ‡¸åœæ•ˆæœï¼ˆé¸å¡«ï¼‰ */
      .mrt-btn:hover {
        background: rgba(240, 244, 252, 1);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
      }

      .flight-select {
        font-family: 'GenSenRounded2TW-R', sans-serif;
        margin-left: 20px;
        padding: 8px 12px;
        border-radius: 8px;
      }

      @media (min-width: 320px) and (max-width: 600px) {
        .scene-1 .transport-grid {
          grid-template-columns: repeat(2, minmax(80px, 1fr));
          grid-template-rows: repeat(3, minmax(120px, 1fr));
        }
      }

      @media (min-width: 600px) and (max-width: 900px) {
        .scene-1 .transport-grid {
          grid-template-columns: repeat(2, minmax(120px, 1fr));
          grid-template-rows: repeat(3, auto);
        }
      }

      @media (max-width: 600px) {
        .scene-1 .transport-card img {
          width: 80px;
          height: 80px;
        }
        .scene-2 .travel-card .toggle-card {
          flex-direction: column;
          justify-content: center;
        }

        .scene-2 .travel-card .toggle-card {
          padding: 32px 16px;
        }
      }

      @media (max-width: 900px) {
        .scene-2 .travel-card .toggle-card, .scene-2 .travel-card .template-wrapper  {
          width: 80%;
          justify-content: space-around;
        }
      }
    </style>
  </head>

  <body>
    <!-- æ•…äº‹åŠ‡æƒ… -->
    <div class="story-body">
      <div class="story-container">
        <header class="story-header">
          <div class="story-header-title">
            <div class="story-header-title-lt">
              <div class="story-header-profile-photo"></div>
              <h1>Neo(2)</h1>
              <i class="fa-solid fa-volume-low" style="color: #6c808f;"></i>
            </div>
            <div class="story-header-title-rt">
              <i class="fa-solid fa-phone"></i>
              <i class="fa-solid fa-ellipsis-vertical"></i>
            </div>
          </div>
        </header>

        <div class="story-chat-container" id="chatContainer"></div>

        <div class="input-container">
          <div class="input-wrapper">
            <input
              type="text"
              class="message-input"
              placeholder="è«‹è¼¸å…¥è¨Šæ¯..."
              aria-label="Message input"
            />
            <div class="action-buttons">
              <button id="send-button" class="send-button">
                <span>å‡ºç™¼</span>
                <i class="fa-regular fa-font-awesome"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Scene 1: é¸è»Šç¨® -->
    <section id="scene-travel-1" class="scene scene-1">
      <Chapter-Bar></Chapter-Bar>
      <div class="slideContainer">
        <h1>æ—¥å¸¸é€šå‹¤ä½¿ç”¨çš„äº¤é€šå·¥å…·</h1>
        <div class="page-indicator">
          <div class="bar-container dynamic-bar-container"></div>
        </div>
        <div class="transport-grid">
          <div class="transport-card" onclick="toggleActivity(this,'æ±½è»Š')">
            <img src="images/æ±½è»Š.png" alt="æ±½è»Š" />
            <span class="label">æ±½è»Š</span>
          </div>
          <div class="transport-card" onclick="toggleActivity(this,'éƒµè¼ª')">
            <img src="images/éƒµè¼ª.png" alt="éƒµè¼ª" />
            <span class="label">éƒµè¼ª</span>
          </div>
          <div class="transport-card" onclick="toggleActivity(this,'é£›æ©Ÿ')">
            <img src="images/é£›æ©Ÿ.png" alt="é£›æ©Ÿ" />
            <span class="label">é£›æ©Ÿ</span>
          </div>
          <div class="transport-card" onclick="toggleActivity(this,'æ·é‹')">
            <img src="images/æ·é‹.png" alt="æ·é‹" />
            <span class="label">æ·é‹</span>
          </div>
          <div class="transport-card" onclick="toggleActivity(this,'ç«è»Š')">
            <img src="images/ç«è»Š.png" alt="ç«è»Š" />
            <span class="label">ç«è»Š</span>
          </div>
          <div class="transport-card" onclick="toggleActivity(this,'é«˜éµ')">
            <img src="images/é«˜éµ.png" alt="é«˜éµ" />
            <span class="label">é«˜éµ</span>
          </div>
        </div>
      </div>
        <button
          class="nav-btn prev-btn"
          onclick="window.location.href='home.html'"
        >
          â€¹
        </button>
        <!-- ç¬¬ä¸€é ä¸‹ä¸€é æŒ‰éˆ• -->
        <button class="nav-btn next-btn" onclick="handleFirstSceneNext()">
          â€º
        </button>
    </section>

    <!-- Scene 1: æ±½è»Š -->
    <section id="scene-travel-2-1" class="scene scene-2">
      <Chapter-Bar></Chapter-Bar>
      <div class="slideContainer">
        <h1>æ±½è»Šä½¿ç”¨ç‹€æ³</h1>
        <div class="page-indicator">
          <div class="bar-container dynamic-bar-container"></div>
        </div>
        <div class="travel-card">
          <!-- ç‡ƒæ–™é–‹é—œ -->
          <div class="toggle-card">
            <span class="label">é¸æ“‡<br />è»Šç¨®ç‡ƒæ–™</span>
            <div class="toggle-row">
              <span class="nowrap-text">æ²¹è»Š</span>
              <label class="toggle-switch">
                <input type="checkbox" id="fuelToggle" />
                <span class="slider"></span>
              </label>
              <span class="nowrap-text">é›»è»Š</span>
            </div>
          </div>
          <!-- æ–¹æ³•é–‹é—œ -->
          <div class="toggle-card">
            <span class="label">é¸æ“‡<br />è¨ˆç®—æ–¹æ³•</span>
            <div class="toggle-row">
              <span class="nowrap-text">è·é›¢</span>
              <label class="toggle-switch">
                <input type="checkbox" id="methodToggle" />
                <span class="slider"></span>
              </label>
              <span class="nowrap-text">æ²¹é‡</span>
            </div>
          </div>

          <div id="pane-left" class="template-wrapper">
            <div id="oil-left" class="fuel-group">
              <div class="input-group">
                <label>é¸æ“‡<br />æ±½æ²¹é¡å‹</label>
                <select>
                  <option>92ç„¡é‰›</option>
                  <option>95ç„¡é‰›</option>
                  <option>98ç„¡é‰›</option>
                  <option>æŸ´æ²¹</option>
                </select>
              </div>
              <div class="input-group">
                <label>æ¯é€±åŠ æ²¹</label>
                <input type="number" />
                <label class="special-label">å…ƒ / é€±</label>
              </div>
            </div>
            <div id="electric-left" class="fuel-group hidden">
              <div class="input-group">
                <label>è¡Œé§›é‡Œç¨‹</label>
                <input type="number" />
                <label class="special-label">å…¬é‡Œ / é€±</label>
              </div>
            </div>
          </div>

          <div id="pane-right" class="template-wrapper">
            <div id="oil-right" class="fuel-group">
              <div class="input-group">
                <label>é¸æ“‡<br />æ±½è»Šé¡å‹</label>
                <select>
                  <option>å°å‹æˆ¿è»Š</option>
                  <option>ä¸­å‹æˆ¿è»Š</option>
                  <option>å¤§å‹æˆ¿è»Š</option>
                  <option>å°å‹ä¼‘æ—…è»Š</option>
                  <option>ä¸­å‹ä¼‘æ—…è»Š</option>
                  <option>å¤§å‹ä¼‘æ—…è»Š</option>
                </select>
              </div>
              <div class="input-group">
                <label>æ¯é€±è¡Œé§›</label>
                <input type="number" />
                <label class="special-label">å…¬é‡Œ / é€±</label>
              </div>
            </div>
            <div id="electric-right" class="fuel-group hidden">
              <div class="input-group">
                <label>å¤–å‡ºå……é›»</label>
                <input type="number" />
                <label class="special-label">kWh / é€±</label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <button class="nav-btn prev-btn" onclick="goToPrevScene()">â€¹</button>
      <button class="nav-btn next-btn" onclick="goToNextScene()">â€º</button>
    </section>

    <!-- Scene 2: éƒµè¼ª -->
    <section id="scene-travel-2-2" class="scene scene-2">
      <Chapter-Bar></Chapter-Bar>
      <div class="slideContainer">
        <h1>éƒµè¼ªæ­ä¹˜æƒ…æ³</h1>
        <div class="page-indicator">
          <div class="bar-container dynamic-bar-container"></div>
        </div>
        <div class="travel-card">
          <div class="template-wrapper add-trip-wrapper">
            <div class="input-group-MRT">
              <label for="cruiseDays">èˆªè¡Œå¤©æ•¸</label>
              <input id="cruiseDays" type="number" min="0"/>
              <label>å¤©</label>
            </div>
            <div class="input-group-MRT">
              <label for="stayDays">åœç•™å¤©æ•¸</label>
              <input id="stayDays" type="number" min="0"/>
              <label>å¤©</label>
            </div>
            <button id="addCruiseBtn" class="mrt-btn">æ–°å¢è¡Œç¨‹</button>
          </div>

          <div class="template-wrapper mrt-trip-list-wrapper" id="cruiseTripDisplay">
            <div class="trip-list"><!-- é€™è£¡æœƒå¡ trip-item --></div>
            <button id="removeCruiseBtn" class="mrt-btn">åˆªé™¤è¡Œç¨‹</button>
          </div>
        </div>
      
      <button class="nav-btn prev-btn" onclick="goToPrevScene()">â€¹</button>
      <button class="nav-btn next-btn" onclick="goToNextScene()">â€º</button>
    </section>
    <!-- ç»ç’ƒå¡ç‰‡ -->

   <!-- Scene 3: é£›æ©Ÿ -->
  <section id="scene-travel-2-3" class="scene scene-2">
    <Chapter-Bar></Chapter-Bar>
    <div class="slideContainer">
      <h1>é£›æ©Ÿæ­ä¹˜æƒ…æ³</h1>
      <div class="page-indicator">
        <div class="bar-container dynamic-bar-container"></div>
      </div>
    <!-- åˆ‡æ›é–‹é—œ -->
      <div class="travel-card">
        <div class="toggle-card">
          <span class="label">é¸æ“‡<br/>è¨ˆç®—æ–¹å¼</span>
          <div class="toggle-row">
            <span class="nowrap-text">æ™‚é–“</span>
            <label class="toggle-switch">
              <input type="checkbox" id="flightModeToggle" />
              <span class="slider"></span>
            </label>
            <span class="nowrap-text">ç«™é»</span>
          </div>
        </div>
        <div class="toggle-card">
          <span class="label">é¸æ“‡<br/>è‰™ç­‰</span>
          <select id="flightClass" class="flight-select">
            <option value="economy">ç¶“æ¿Ÿè‰™</option>
            <option value="premium">è±ªè¯ç¶“æ¿Ÿè‰™</option>
            <option value="business">å•†å‹™è‰™</option>
          </select>
        </div>

        <!-- æ™‚é–“æ¨¡å¼ï¼šä¸€æ•´å¡Šæ¿å­ -->
        <div id="flight-time-wrapper" class="template-wrapper">
          <div class="input-group-MRT">
            <label for="flightTime">é£›è¡Œæ™‚æ•¸</label>
            <input id="flightTime" type="number" min="0" />
            <label class="special-label">å°æ™‚</label>
          </div>
        </div>

        <!-- ç«™é»æ¨¡å¼ï¼šä¿ç•™åŸæœ¬çš„å·¦å³å…©å¡Š + åˆ—è¡¨ -->
        <div id="flight-station-wrapper" class="template-row hidden">
          <div class="template-wrapper">
            <div class="input-group-MRT">
              <label for="flightStart">èµ·é»</label>
              <input list="airportStationList" id="flightStart" />
            </div>
            <div class="input-group-MRT">
              <label for="flightEnd">è¨–é»</label>
              <input list="airportStationList" id="flightEnd" />
              <datalist id="airportStationList"></datalist>
            </div>
            <div class="input-group-MRT">
              <label for="flightCount">è¶Ÿæ•¸</label>
              <input id="flightCount" type="number" min="1" />
            </div>
            <div class="simple-toggle">
              <span class="nowrap-text">å–®ç¨‹</span>
              <label class="toggle-switch">
                <input type="checkbox" id="roundTripToggle" />
                <span class="slider"></span>
              </label>
              <span class="nowrap-text">ä¾†å›</span>
            </div>
            <button class="mrt-btn" id="addFlightBtn">æ–°å¢èˆªç­</button>
          </div>
          <div class="template-wrapper mrt-trip-list-wrapper" id="flightTripDisplay">
            <div class="trip-list"><!-- trip-item --></div>
            <button class="mrt-btn" id="removeFlightBtn">åˆªé™¤è¡Œç¨‹</button>
          </div>
        </div>
      </div>
    </div>

      <button class="nav-btn prev-btn" onclick="goToPrevScene()">â€¹</button>
      <button class="nav-btn next-btn" onclick="goToNextScene()">â€º</button>
  </section>

    <!-- Scene 4: æ·é‹ -->
    <section id="scene-travel-2-4" class="scene scene-2">
      <Chapter-Bar></Chapter-Bar>
      <div class="slideContainer">
        <h1>æ·é‹ä½¿ç”¨æƒ…æ³</h1>
        <div class="page-indicator">
          <div class="bar-container dynamic-bar-container"></div>
        </div>
        <div class="travel-card">
          <div class="template-wrapper add-trip-wrapper">
            <div class="input-group-MRT">
              <label for="mrtStart">é¸æ“‡èµ·é»</label>
              <input list="mrtStationList" id="mrtStart" />
            </div>
            <div class="input-group-MRT">
              <label for="mrtEnd">é¸æ“‡è¨–é»</label>
              <input list="mrtStationList" id="mrtEnd" />
              <datalist id="mrtStationList"></datalist>
            </div>
            <div class="input-group-MRT">
              <label for="mrtCount">æ¯æœˆæ­ä¹˜</label>
              <input id="mrtCount" type="number" min="1" />
              <label class="special-label">è¶Ÿ</label>
            </div>
            <button class="mrt-btn" >æ–°å¢è¡Œç¨‹</button>
          </div>

          <!-- é€™è£¡ä¸€å®šè¦åŠ ä¸Š id="mrtTripDisplay" -->
          <div class="template-wrapper mrt-trip-list-wrapper" id="mrtTripDisplay">
            <div class="trip-list"><!-- é€™è£¡æœƒå¡ trip-item --></div>
            <button class="mrt-btn">åˆªé™¤è¡Œç¨‹</button>
          </div>
        </div>
      </div>
      <button class="nav-btn prev-btn" onclick="goToPrevScene()">â€¹</button>
      <button class="nav-btn next-btn" onclick="goToNextScene()">â€º</button>
    </section>

    <!-- Scene 5: ç«è»Š -->
    <section id="scene-travel-2-5" class="scene scene-2">
      <Chapter-Bar></Chapter-Bar>
      <div class="slideContainer">
        <h1>ç«è»Šä½¿ç”¨æƒ…æ³</h1>
        <div class="page-indicator">
          <div class="bar-container dynamic-bar-container"></div>
        </div>
        <div class="travel-card">
          <div class="template-wrapper add-trip-wrapper">
            <div class="input-group-MRT">
              <label for="trainStart">é¸æ“‡èµ·é»</label>
              <input list="trDistanceMap" id="trainStart" />
            </div>
            <div class="input-group-MRT">
              <label for="trainEnd">é¸æ“‡è¨–é»</label>
              <input list="trDistanceMap" id="trainEnd" />
              <datalist id="trDistanceMap"></datalist>
            </div>
            <div class="input-group-MRT">
              <label for="trainCount">æ¯æœˆæ­ä¹˜</label>
              <input id="trainCount" type="number" min="1" />
              <label class="special-label">è¶Ÿ</label>
            </div>
            <button class="mrt-btn">æ–°å¢è¡Œç¨‹</button>
          </div>
          <div class="template-wrapper mrt-trip-list-wrapper">
            <div class="trip-list" id="trainTripList"></div>
            <button class="mrt-btn">åˆªé™¤è¡Œç¨‹</button>
          </div>
        </div>
      </div>
      <button class="nav-btn prev-btn" onclick="goToPrevScene()">â€¹</button>
      <button class="nav-btn next-btn" onclick="goToNextScene()">â€º</button>
    </section>

    <!-- Scene 6: é«˜éµ -->
    <section id="scene-travel-2-6" class="scene scene-2">
      <Chapter-Bar></Chapter-Bar>
      <div class="slideContainer">
        <h1>é«˜éµä½¿ç”¨æƒ…æ³</h1>
        <div class="page-indicator">
          <div class="bar-container dynamic-bar-container"></div>
        </div>
        <div class="travel-card">
          <div class="template-wrapper add-trip-wrapper">
            <div class="input-group-MRT">
              <label for="hsrStart">é¸æ“‡èµ·é»</label>
              <input list="hsrStationList" id="hsrStart" />          
            </div>
            <div class="input-group-MRT">
              <label for="hsrEnd">é¸æ“‡è¨–é»</label>
              <input list="hsrStationList" id="hsrEnd" />
              <datalist id="hsrStationList"></datalist>
            </div>
            <div class="input-group-MRT">
              <label for="hsrCount">æ¯æœˆæ­ä¹˜</label>
              <input id="hsrCount" type="number" min="1" />
              <label class="special-label">è¶Ÿ</label>
            </div>
            <button class="mrt-btn">æ–°å¢è¡Œç¨‹</button>
          </div>
          <div class="template-wrapper mrt-trip-list-wrapper">
            <div class="trip-list" id="hsrTripList"></div>
            <button class="mrt-btn">åˆªé™¤è¡Œç¨‹</button>
          </div>
        </div>
      </div>
      <button class="nav-btn prev-btn" onclick="goToPrevScene()">â€¹</button>
      <button class="nav-btn next-btn" onclick="goToNextScene()">â€º</button>
    </section>

    <script src="./js/all.js"></script>
    <script>
            // æ˜Ÿéš›èŠå¤©å®¤

      const messages = [
        {
          type: "time",
          text: "ä¸Šåˆ 9:30",
          time: 1000,
        },
        {
          text: "æ­¡è¿æ­ä¹˜ç¢³æ’èˆªç©º707æ¬¡ç­æ©Ÿï¼Œæœ¬æ¬¡èˆªç¨‹å°‡å¸¶æ‚¨é€²å…¥å™´å°„æ©Ÿèˆ‡å…¨çƒåŒ–çš„å¹´ä»£ï¼Œè«‹ç¹«å¥½å®‰å…¨å¸¶â€¦â€¦æˆ–è€…ï¼Œç·ŠæŠ±æœ¬å–µä¹Ÿè¡Œï¼",
          from: "cat",
          time: 2500,
        },
        {
          text: "é€™æ˜¯å“ªä¸€å¹´ï¼Ÿé£›æ©Ÿå‰›å‡ºç¾ï¼Ÿ",
          from: "user",
          time: 1500,
        },
        {
          text: "1958å¹´ã€‚æ³¢éŸ³707é¦–èˆªï¼Œå¾æ­¤ä¸–ç•Œè®Šå°äº†ï¼Œäººå€‘èƒ½å¤ å¹¾å°æ™‚å…§é£›è¶Šå¤§æ´²ã€‚æ–¼æ˜¯å•†æ¥­æ´»å‹•ã€æ—…éŠã€ç”šè‡³åœ‹éš›æˆ€æ„›ï¼Œå…¨éƒ½è®Šå¾—ç¨€é¬†å¹³å¸¸ã€‚",
          from: "cat",
          time: 2500,
        },
        {
          text: "æ‰€ä»¥æˆ‘æ˜¨å¤©é‚„åœ¨å€«æ•¦åƒæ—©é¤ï¼Œä»Šå¤©å°±èƒ½åœ¨å°åŒ—åƒé¹½é…¥é›å›‰ï¼",
          from: "user",
          time: 1700,
        },
        {
          text: "æ²’éŒ¯ï¼å…¨çƒçš„å•†æ¥­æ´»å‹•ç¬é–“åŠ é€Ÿï¼Œä½†ä¹Ÿæ„å‘³è‘—åŒ–çŸ³ç‡ƒæ–™çš„éœ€æ±‚çˆ†ç‚¸æ€§æˆé•·ã€‚é£›æ©Ÿç•™ä¸‹çš„ç™½ç…™ï¼Œå°é«˜ç©ºå¤§æ°£å±¤çš„å½±éŸ¿æ¯”åœ°é¢é‚„è¦åš´é‡ã€‚",
          from: "cat",
        },
      ];

      const chatContainer = document.getElementById("chatContainer");

      function createMessageElement(message) {
        if (message.type === "time") {
          const timeEl = document.createElement("div");
          timeEl.classList.add("story-time-stamp");
          timeEl.textContent = message.text;
          return timeEl;
        }

        const wrapper = document.createElement("div");
        wrapper.classList.add(
          "story-message",
          message.from === "user" ? "story-user-message" : "story-cat-message"
        );

        const avatar = document.createElement("div");
        avatar.classList.add("story-avatar");
        avatar.textContent = message.from === "user" ? "U" : "A";

        const bubble = document.createElement("div");
        bubble.classList.add("story-message-bubble");
        bubble.textContent = message.text;

        wrapper.appendChild(avatar);
        wrapper.appendChild(bubble);
        return wrapper;
      }

    async function playIntroMessages() {
      for (let i = 0; i < messages.length; i++) {
        const el = createMessageElement(messages[i]);
        const messageTime = messages[i].time;
        chatContainer.appendChild(el);
        chatContainer.scrollTop = chatContainer.scrollHeight;
        await new Promise((resolve) => setTimeout(resolve, messageTime));
      }
    }

      window.addEventListener("DOMContentLoaded", playIntroMessages);
        let currentScene = "scene-travel-1";

        function goToNextScene() {
          // å–å¾—ç›®å‰å ´æ™¯åœ¨ä½¿ç”¨è€…é¸å–æ´»å‹•ä¸­çš„ä½ç½®
          const currentIndex = selectedActivities.findIndex(
            (activity) => activityScenes[activity] === currentScene
          );

          // æ˜¯æœ€å¾Œä¸€å€‹å ´æ™¯ â†’ å°å‘çµæœé 
          if (currentIndex === selectedActivities.length - 1) {
            window.location.href = "food.html";
            return;
          }

          // é‚„æœ‰ä¸‹ä¸€é  â†’ å–å¾—ä¸‹ä¸€å€‹æ´»å‹•çš„ sceneIdï¼Œè·³è½‰
          const nextActivity = selectedActivities[currentIndex + 1];
          const nextSceneId = activityScenes[nextActivity];
          if (nextSceneId) {
            goToScene(nextSceneId);
          }
        }

        function goToPrevScene() {
          const currentIndex = selectedActivities.findIndex(
            (activity) => activityScenes[activity] === currentScene
          );

          // æ˜¯ç¬¬ä¸€å€‹é¸æ“‡çš„æ´»å‹• â†’ å›åˆ° scene-travel-1
          if (currentIndex === 0) {
            goToScene("scene-travel-1");
            return;
          }

          // é‚„æœ‰ä¸Šä¸€é  â†’ è·³åˆ°ä¸Šä¸€å€‹æ´»å‹•é é¢
          const prevActivity = selectedActivities[currentIndex - 1];
          const prevSceneId = activityScenes[prevActivity];
          if (prevSceneId) {
            goToScene(prevSceneId);
          }
        }

        function handleFirstSceneNext() {
          // å›ºå®šé †åº
          const fullOrder = [
            "æ±½è»Š",
            "éƒµè¼ª",
            "é£›æ©Ÿ",
            "æ·é‹",
            "ç«è»Š",
            "é«˜éµ",
          ];

          // éæ¿¾é¸å–çš„é …ç›®ä¸¦ä¾ç…§å›ºå®šé †åºæ’åº
          const sortedActivities = fullOrder.filter((activity) =>
            selectedActivities.includes(activity)
          );

          // æ›´æ–°é™£åˆ—
          selectedActivities.length = 0;
          selectedActivities.push(...sortedActivities);

          if (selectedActivities.length === 0) {
            alert("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹äº¤é€šå·¥å…·ï¼");
            return;
          }

          const firstScene = activityScenes[selectedActivities[0]];
          goToScene(firstScene);
        }

        const selectedActivities = []; // å„²å­˜é¸å–çš„é …ç›®
        const activityScenes = {
          æ±½è»Š: "scene-travel-2-1",
          éƒµè¼ª: "scene-travel-2-2",
          é£›æ©Ÿ: "scene-travel-2-3",
          æ·é‹: "scene-travel-2-4",
          ç«è»Š: "scene-travel-2-5",
          é«˜éµ: "scene-travel-2-6",
        };

        function toggleActivity(card, activity) {
          const index = selectedActivities.indexOf(activity);

          if (index === -1) {
            selectedActivities.push(activity);
            card.classList.add("selected");
          } else {
            selectedActivities.splice(index, 1);
            card.classList.remove("selected");
          }

          updatePageIndicators();
        }

        // barè·³è½‰é é¢

        function goToScene(targetId) {
          document.getElementById(currentScene).classList.remove("active");
          document.getElementById(targetId).classList.add("active");
          currentScene = targetId;
          updatePageIndicators();
          updateNavButtonsVisibility();
        }

      function updatePageIndicators() {
        const scene = document.getElementById(currentScene);
        const container = scene.querySelector(".dynamic-bar-container");

        if (!container) return;
        container.innerHTML = "";

        // ğŸ‘‰ 1. å…ˆåŠ ä¸Šã€Œé¸æ“‡é ã€çš„ barï¼ˆæ°¸é æ˜¯ç¬¬ä¸€å€‹ï¼‰
        const selectHitArea = document.createElement("div");
        selectHitArea.classList.add("bar-hit-area");

        const selectBar = document.createElement("span");
        selectBar.classList.add("bar");

        // å¦‚æœç¾åœ¨é é¢æ˜¯ scene-travel-1ï¼Œè¨­å®š active ç‹€æ…‹
        if (currentScene === "scene-travel-1") {
          selectBar.classList.add("active");
        }

        selectHitArea.appendChild(selectBar);
        selectHitArea.onclick = () => {
          goToScene("scene-travel-1");
          updateBarActive(0); // ç¬¬ä¸€å€‹ bar æ˜¯ index 0
        };
        container.appendChild(selectHitArea);

        // ğŸ‘‰ 2. ä¾æ“šé¸åˆ°çš„ activity åŠ ä¸Šå°æ‡‰ bar
        selectedActivities.forEach((activity, idx) => {
          const sceneId = activityScenes[activity];
          if (!sceneId) return;

          const hitArea = document.createElement("div");
          hitArea.classList.add("bar-hit-area");

          const bar = document.createElement("span");
          bar.classList.add("bar");

          // æ³¨æ„ï¼šå› ç‚ºç¬¬ä¸€å€‹ bar æ˜¯é¸æ“‡é ï¼Œé€™é‚Šæ˜¯ idx+1
          if (currentScene === sceneId) {
            bar.classList.add("active");
          }

          hitArea.appendChild(bar);

          hitArea.onclick = () => {
            goToScene(sceneId);
            updateBarActive(idx + 1);
          };

          container.appendChild(hitArea);
        });
      }

      function updateNavButtonsVisibility() {
        const sceneEl = document.getElementById(currentScene);

        // å–å¾—æŒ‰éˆ•ï¼ˆç”¨ querySelector æ‰¾ç•¶å‰ scene è£¡çš„æŒ‰éˆ•ï¼‰
        const prevBtn = sceneEl.querySelector(".prev-btn");
        const nextBtn = sceneEl.querySelector(".next-btn");

        // å…¨éƒ¨å…ˆéš±è—
        document.querySelectorAll(".prev-btn, .next-btn").forEach(btn => {
          btn.style.display = "none";
        });

        // é€™å€‹ scene æœ‰çš„æ‰é¡¯ç¤º
        if (prevBtn) prevBtn.style.display = "block";
        if (nextBtn) nextBtn.style.display = "block";
      }


      function updateBarActive(activeIndex) {
        const scene = document.getElementById(currentScene);
        const container = scene.querySelector(".dynamic-bar-container");
        if (!container) return;

        const bars = container.querySelectorAll(".bar-hit-area .bar");
        bars.forEach((bar, idx) => {
          if (idx === activeIndex) {
            bar.classList.add("active");
          } else {
            bar.classList.remove("active");
          }
        });
      }

      function goToScene(targetId) {
        document.getElementById(currentScene).classList.remove("active");
        document.getElementById(targetId).classList.add("active");
        currentScene = targetId;
        updatePageIndicators();
        updateNavButtonsVisibility();
      }

      function updateNavButtonsVisibility() {
        const sceneEl = document.getElementById(currentScene);

        const prevBtn = sceneEl.querySelector(".prev-btn");
        const nextBtn = sceneEl.querySelector(".next-btn");

        document.querySelectorAll(".prev-btn, .next-btn").forEach((btn) => {
          btn.style.display = "none";
        });

        if (prevBtn) prevBtn.style.display = "block";
        if (nextBtn) nextBtn.style.display = "block";
      }

      function updatePageIndicators() {
        const scene = document.getElementById(currentScene);
        const container = scene.querySelector(".dynamic-bar-container");

        if (!container) return;
        container.innerHTML = "";

        // â¤ ç¬¬ä¸€å€‹ barï¼šé¸æ“‡äº¤é€šå·¥å…·é é¢
        const selectHitArea = document.createElement("div");
        selectHitArea.classList.add("bar-hit-area");

        const selectBar = document.createElement("span");
        selectBar.classList.add("bar");

        if (currentScene === "scene-travel-1") {
          selectBar.classList.add("active");
        }

        selectHitArea.appendChild(selectBar);
        selectHitArea.onclick = () => {
          goToScene("scene-travel-1");
          updateBarActive(0);
        };
        container.appendChild(selectHitArea);
          // ğŸ‘‰ 2. ä¾æ“šé¸åˆ°çš„ activity åŠ ä¸Šå°æ‡‰ bar
        selectedActivities.forEach((activity, idx) => {
          const sceneId = activityScenes[activity];
          if (!sceneId) return;

          const hitArea = document.createElement("div");
          hitArea.classList.add("bar-hit-area");

          const bar = document.createElement("span");
          bar.classList.add("bar");

          // æ³¨æ„ï¼šå› ç‚ºç¬¬ä¸€å€‹ bar æ˜¯é¸æ“‡é ï¼Œé€™é‚Šæ˜¯ idx+1
          if (currentScene === sceneId) {
            bar.classList.add("active");
          }

          hitArea.appendChild(bar);

          hitArea.onclick = () => {
            goToScene(sceneId);
            updateBarActive(idx + 1);
          };

          container.appendChild(hitArea);
        });
      }

      function updateBarActive(activeIndex) {
        const scene = document.getElementById(currentScene);
        const container = scene.querySelector(".dynamic-bar-container");
        if (!container) return;

        const bars = container.querySelectorAll(".bar-hit-area .bar");
        bars.forEach((bar, idx) => {
          bar.classList.toggle("active", idx === activeIndex);
        });
      }

      document.addEventListener("DOMContentLoaded", () => {
        currentScene = "scene-travel-1";
        updatePageIndicators();
        updateNavButtonsVisibility();
      });


// ===== 2. å…¶ä»–åˆå§‹åŒ–ï¼ˆä½ åŸæœ¬çš„å…§å®¹ï¼‰ =====
// ===== æ±½è»Šåˆ‡æ›åŠŸèƒ½ =====
  function setupToggle(fuelId, methodId, oilLeftId, oilRightId, elecLeftId, elecRightId, paneLeftId, paneRightId) {
    const fuelToggle   = document.getElementById(fuelId);
    const methodToggle = document.getElementById(methodId);
    const oilLeft      = document.getElementById(oilLeftId);
    const oilRight     = document.getElementById(oilRightId);
    const elecLeft     = document.getElementById(elecLeftId);
    const elecRight    = document.getElementById(elecRightId);
    const paneLeft     = document.getElementById(paneLeftId);
    const paneRight    = document.getElementById(paneRightId);

    function updateFuel() {
      const isElec = fuelToggle.checked;
      oilLeft.classList.toggle("hidden", isElec);
      oilRight.classList.toggle("hidden", isElec);
      elecLeft.classList.toggle("hidden", !isElec);
      elecRight.classList.toggle("hidden", !isElec);
    }
    
    function updateMethod() {
      const isVol = methodToggle.checked;
      paneLeft.classList.toggle("inactive", isVol);
      paneRight.classList.toggle("inactive", !isVol);
    }
    
    fuelToggle.addEventListener("change", () => { updateFuel(); updateMethod(); });
    methodToggle.addEventListener("change", updateMethod);
    updateFuel();
    updateMethod();
  }

function haversine(a, b) {
    const toRad = x => x * Math.PI / 180;
    const R = 6371;
    const dLat = toRad(b.lat - a.lat);
    const dLon = toRad(b.lng - a.lng);
    const lat1 = toRad(a.lat), lat2 = toRad(b.lat);
    const h = Math.sin(dLat/2)**2 + Math.sin(dLon/2)**2 * Math.cos(lat1) * Math.cos(lat2);
    return 2 * R * Math.asin(Math.sqrt(h));
  }

  //è¡Œç¨‹è³‡æ–™åŠ è¼‰
  let airportCoords = {}, mrtDistanceMap = {}, trDistanceMap = {}, hsrDistanceMap = {};

  document.addEventListener("DOMContentLoaded", () => {
    // è¨­ç½®æ±½è»Šçš„åˆ‡æ›åŠŸèƒ½
    setupToggle("fuelToggle", "methodToggle", "oil-left", "oil-right", "electric-left", "electric-right", "pane-left", "pane-right");

    // è¼‰å…¥å„åœ°åœ–è³‡æ–™
    fetch("./data/AirportDistanceMap.json").then(r => r.json()).then(data => {
      const dl = document.getElementById("airportStationList");
      if (dl) {
        data.forEach(({ iata_code, latitude_deg, longitude_deg }) => {
          airportCoords[iata_code] = { lat: latitude_deg, lng: longitude_deg };
          const o = document.createElement("option");
          o.value = iata_code;
          dl.appendChild(o);
        });
      }
    }).catch(err => console.log("Airport data not loaded:", err));

    fetch("./data/mrtDistanceMap.json").then(r => r.json()).then(data => {
      mrtDistanceMap = data;
      const dl = document.getElementById("mrtStationList");
      if (dl) {
        new Set(Object.keys(data).flatMap(k => k.split("_"))).forEach(st => {
          const o = document.createElement("option");
          o.value = st;
          dl.appendChild(o);
        });
      }
    }).catch(err => console.log("MRT data not loaded:", err));

    fetch("./data/trDistanceMap.json").then(r => r.json()).then(data => {
      trDistanceMap = data;
      console.log("Train distance map loaded:", data); // ç”¨æ–¼é™¤éŒ¯
      console.log("Train data structure type:", typeof data); // æ–°å¢ï¼šæª¢æŸ¥æ•¸æ“šé¡å‹
      console.log("Train data sample keys:", Object.keys(data).slice(0, 10)); // æ–°å¢ï¼šæª¢æŸ¥å‰10å€‹éµå€¼
      
      const dl = document.getElementById("trDistanceMap");
      if (dl) {
        // è™•ç†ç«è»Šç«™åˆ—è¡¨ï¼Œå¯èƒ½æ˜¯å·¢ç‹€çµæ§‹
        const stations = new Set();
        if (typeof data === 'object') {
          Object.keys(data).forEach(key => {
            stations.add(key);
            // å¦‚æœå€¼æ˜¯ç‰©ä»¶ï¼Œä¹ŸåŠ å…¥å…¶éµå€¼
            if (typeof data[key] === 'object') {
              Object.keys(data[key]).forEach(subKey => stations.add(subKey));
            }
          });
        }
        stations.forEach(st => {
          const o = document.createElement("option");
          o.value = st;
          dl.appendChild(o);
        });
      }
    }).catch(err => console.log("Train data not loaded:", err));

    fetch("./data/hsrDistanceMap.json").then(r => r.json()).then(data => {
      hsrDistanceMap = data;
      const dl = document.getElementById("hsrStationList");
      if (dl) {
        new Set(Object.keys(data).flatMap(k => k.split("_"))).forEach(st => {
          const o = document.createElement("option");
          o.value = st;
          dl.appendChild(o);
        });
      }
    }).catch(err => console.log("HSR data not loaded:", err));

    // é£›æ©Ÿé¸é …åˆ‡æ›
    const modeToggle = document.getElementById("flightModeToggle");
    const timeWrap = document.getElementById("flight-time-wrapper");
    const stationWrap = document.getElementById("flight-station-wrapper");
    
    if (modeToggle && timeWrap && stationWrap) {
      modeToggle.addEventListener("change", () => {
        const isStation = modeToggle.checked;
        timeWrap.classList.toggle("hidden", isStation);
        stationWrap.classList.toggle("hidden", !isStation);
      });
      timeWrap.classList.remove("hidden");
      stationWrap.classList.add("hidden");
    }

    // ç¶å®šæŒ‰éˆ• - ä½¿ç”¨æ›´å®‰å…¨çš„æ–¹å¼
    const addCruiseBtn = document.getElementById("addCruiseBtn");
    const removeCruiseBtn = document.getElementById("removeCruiseBtn");
    if (addCruiseBtn) addCruiseBtn.addEventListener("click", addCruiseTrip);
    if (removeCruiseBtn) removeCruiseBtn.addEventListener("click", removeCruiseTrip);
    
    // æ·é‹æŒ‰éˆ•
    const mrtAddBtn = document.querySelector("#scene-travel-2-4 .add-trip-wrapper .mrt-btn");
    const mrtRemoveBtn = document.querySelector("#scene-travel-2-4 .mrt-trip-list-wrapper .mrt-btn");
    if (mrtAddBtn) mrtAddBtn.addEventListener("click", addMRTTrip);
    if (mrtRemoveBtn) mrtRemoveBtn.addEventListener("click", removeMRTTrip);
    
    // ç«è»ŠæŒ‰éˆ•
    const trainAddBtn = document.querySelector("#scene-travel-2-5 .add-trip-wrapper .mrt-btn");
    const trainRemoveBtn = document.querySelector("#scene-travel-2-5 .mrt-trip-list-wrapper .mrt-btn");
    if (trainAddBtn) trainAddBtn.addEventListener("click", addTrainTrip);
    if (trainRemoveBtn) trainRemoveBtn.addEventListener("click", removeTrainTrip);
    
    // é«˜éµæŒ‰éˆ•
    const hsrAddBtn = document.querySelector("#scene-travel-2-6 .add-trip-wrapper .mrt-btn");
    const hsrRemoveBtn = document.querySelector("#scene-travel-2-6 .mrt-trip-list-wrapper .mrt-btn");
    if (hsrAddBtn) hsrAddBtn.addEventListener("click", addHsrTrip);
    if (hsrRemoveBtn) hsrRemoveBtn.addEventListener("click", removeHsrTrip);
    
    // é£›æ©ŸæŒ‰éˆ•
    const addFlightBtn = document.getElementById("addFlightBtn");
    const removeFlightBtn = document.getElementById("removeFlightBtn");
    if (addFlightBtn) addFlightBtn.addEventListener("click", addFlightTrip);
    if (removeFlightBtn) removeFlightBtn.addEventListener("click", removeFlightTrip);

    // ç¶å®š trip-item é»æ“Šé¸å–
    ["#cruiseTripDisplay", "#mrtTripDisplay", "#flightTripDisplay"].forEach(selector => {
      const container = document.querySelector(`${selector} .trip-list`);
      if (container) {
        container.addEventListener("click", e => {
          const item = e.target.closest(".trip-item");
          if (!item) return;
          container.querySelectorAll(".trip-item").forEach(el => el.classList.remove("selected"));
          item.classList.add("selected");
        });
      }
    });

    // ç‚ºç«è»Šå’Œé«˜éµæ·»åŠ é»æ“Šé¸å–åŠŸèƒ½
    const trainContainer = document.getElementById("trainTripList");
    if (trainContainer) {
      trainContainer.addEventListener("click", e => {
        const item = e.target.closest(".trip-item");
        if (!item) return;
        trainContainer.querySelectorAll(".trip-item").forEach(el => el.classList.remove("selected"));
        item.classList.add("selected");
      });
    }

    const hsrContainer = document.getElementById("hsrTripList");
    if (hsrContainer) {
      hsrContainer.addEventListener("click", e => {
        const item = e.target.closest(".trip-item");
        if (!item) return;
        hsrContainer.querySelectorAll(".trip-item").forEach(el => el.classList.remove("selected"));
        item.classList.add("selected");
      });
    }
  });

  function makeSelectable(item) {
    item.classList.add("trip-item");
  }

  function addTrip(map, startId, endId, countId, displaySelector) {
    const s = document.getElementById(startId).value.trim();
    const e = document.getElementById(endId).value.trim();
    const c = parseInt(document.getElementById(countId).value, 10) || 0;
    
    if (!s || !e || c <= 0) {
      return alert("è«‹å¡«å¯«å®Œæ•´çš„èµ·è¨–é»ä¸¦è¼¸å…¥è¶Ÿæ•¸");
    }
    
    const dist = map[`${s}_${e}`];
    if (dist === undefined) return alert("è«‹é¸æ“‡æ­£ç¢ºçš„èµ·è¨–é»ä¸¦è¼¸å…¥è¶Ÿæ•¸");

    const item = document.createElement("div");
    makeSelectable(item);
    item.textContent = `${s} â†’ ${e} Ã— ${c}`;
    const listContainer = document.querySelector(`${displaySelector} .trip-list`);
    if (listContainer) {
      listContainer.appendChild(item);
    }
  }

  function deleteTrip(displaySelector) {
    const list = document.querySelector(`${displaySelector} .trip-list`);
    if (!list) return alert("æ‰¾ä¸åˆ°è¡Œç¨‹åˆ—è¡¨");
    const sel = list.querySelector(".trip-item.selected");
    if (sel) sel.remove();
    else if (list.lastChild) list.lastChild.remove();
    else alert("æ²’æœ‰è¡Œç¨‹å¯åˆªé™¤");
  }

  // ===== å„äº¤é€šå·¥å…·çš„æ–°å¢/åˆªé™¤å‡½æ•¸ =====

  function addCruiseTrip() {
    const sail = parseInt(document.getElementById("cruiseDays").value, 10) || 0;
    const stay = parseInt(document.getElementById("stayDays").value, 10) || 0;
    if (sail < 0 || stay < 0) return alert("å¤©æ•¸ä¸èƒ½æ˜¯è² æ•¸");
    if (sail === 0 && stay === 0) return alert("è«‹è¼¸å…¥èˆªè¡Œå¤©æ•¸æˆ–åœç•™å¤©æ•¸");
    
    const item = document.createElement("div");
    makeSelectable(item);
    item.textContent = `èˆªè¡Œ: ${sail}å¤©, åœç•™: ${stay}å¤© (å…±: ${sail + stay}å¤©)`;
    document.querySelector("#cruiseTripDisplay .trip-list").appendChild(item);
    
    // æ¸…ç©ºè¼¸å…¥æ¬„ä½
    document.getElementById("cruiseDays").value = "";
    document.getElementById("stayDays").value = "";
  }

  function removeCruiseTrip() {
    deleteTrip("#cruiseTripDisplay");
  }

  function addMRTTrip() {
    addTrip(mrtDistanceMap, "mrtStart", "mrtEnd", "mrtCount", "#mrtTripDisplay");
  }

  function removeMRTTrip() {
    deleteTrip("#mrtTripDisplay");
  }

  // ä¿®å¾©å¾Œçš„ç«è»Šå‡½æ•¸ - é‡å°é‡Œç¨‹æ•¸æ ¼å¼çš„æ•¸æ“š
  function addTrainTrip() {
    const s = document.getElementById("trainStart").value.trim();
    const e = document.getElementById("trainEnd").value.trim();
    const c = parseInt(document.getElementById("trainCount").value, 10) || 0;
    
    if (!s || !e || c <= 0) {
      return alert("è«‹å¡«å¯«å®Œæ•´çš„èµ·è¨–é»ä¸¦è¼¸å…¥è¶Ÿæ•¸");
    }
    
    console.log("Train search:", s, "to", e); // é™¤éŒ¯ç”¨
    console.log("Start station data:", trDistanceMap[s]); // é™¤éŒ¯ç”¨
    console.log("End station data:", trDistanceMap[e]); // é™¤éŒ¯ç”¨
    
    // æª¢æŸ¥èµ·é»ç«™æ˜¯å¦å­˜åœ¨
    if (trDistanceMap[s] === undefined) {
      const availableStations = Object.keys(trDistanceMap).filter(station => 
        station.toLowerCase().includes(s.toLowerCase()) || 
        s.toLowerCase().includes(station.toLowerCase())
      );
      return alert(`æ‰¾ä¸åˆ°è»Šç«™ "${s}"ã€‚\nå¯èƒ½çš„è»Šç«™åç¨±: ${availableStations.slice(0, 5).join(', ')}${availableStations.length > 5 ? '...' : ''}`);
    }
    
    // æª¢æŸ¥çµ‚é»ç«™æ˜¯å¦å­˜åœ¨
    if (trDistanceMap[e] === undefined) {
      const availableStations = Object.keys(trDistanceMap).filter(station => 
        station.toLowerCase().includes(e.toLowerCase()) || 
        e.toLowerCase().includes(station.toLowerCase())
      );
      return alert(`æ‰¾ä¸åˆ°è»Šç«™ "${e}"ã€‚\nå¯èƒ½çš„è»Šç«™åç¨±: ${availableStations.slice(0, 5).join(', ')}${availableStations.length > 5 ? '...' : ''}`);
    }
    
    // è¨ˆç®—å…©ç«™é–“çš„è·é›¢ï¼ˆé‡Œç¨‹æ•¸çš„çµ•å°å·®å€¼ï¼‰
    const startKm = trDistanceMap[s];
    const endKm = trDistanceMap[e];
    const dist = Math.abs(endKm - startKm).toFixed(1);
    
    console.log("Calculated distance:", dist, "km"); // é™¤éŒ¯ç”¨

    const item = document.createElement("div");
    makeSelectable(item);
    item.textContent = `${s} â†’ ${e} Ã— ${c}è¶Ÿ (${dist}km)`;
    document.getElementById("trainTripList").appendChild(item);
    
    // æ¸…ç©ºè¼¸å…¥æ¬„ä½
    document.getElementById("trainStart").value = "";
    document.getElementById("trainEnd").value = "";
    document.getElementById("trainCount").value = "";
  }

  function removeTrainTrip() {
    const list = document.getElementById("trainTripList");
    if (!list) return alert("æ‰¾ä¸åˆ°è¡Œç¨‹åˆ—è¡¨");
    const sel = list.querySelector(".trip-item.selected");
    if (sel) sel.remove();
    else if (list.lastChild) list.lastChild.remove();
    else alert("æ²’æœ‰è¡Œç¨‹å¯åˆªé™¤");
  }

  // ä¿®å¾©å¾Œçš„é«˜éµå‡½æ•¸
  function addHsrTrip() {
    const s = document.getElementById("hsrStart").value.trim();
    const e = document.getElementById("hsrEnd").value.trim();
    const c = parseInt(document.getElementById("hsrCount").value, 10) || 0;
    
    if (!s || !e || c <= 0) {
      return alert("è«‹å¡«å¯«å®Œæ•´çš„èµ·è¨–é»ä¸¦è¼¸å…¥è¶Ÿæ•¸");
    }
    
    const dist = hsrDistanceMap[`${s}_${e}`] || hsrDistanceMap[`${e}_${s}`];
    if (dist === undefined) return alert("è«‹é¸æ“‡æ­£ç¢ºçš„èµ·è¨–é»ä¸¦è¼¸å…¥è¶Ÿæ•¸");

    const item = document.createElement("div");
    makeSelectable(item);
    item.textContent = `${s} â†’ ${e} Ã— ${c}è¶Ÿ`;
    document.getElementById("hsrTripList").appendChild(item);
    
    // æ¸…ç©ºè¼¸å…¥æ¬„ä½
    document.getElementById("hsrStart").value = "";
    document.getElementById("hsrEnd").value = "";
    document.getElementById("hsrCount").value = "";
  }

  function removeHsrTrip() {
    const list = document.getElementById("hsrTripList");
    if (!list) return alert("æ‰¾ä¸åˆ°è¡Œç¨‹åˆ—è¡¨");
    const sel = list.querySelector(".trip-item.selected");
    if (sel) sel.remove();
    else if (list.lastChild) list.lastChild.remove();
    else alert("æ²’æœ‰è¡Œç¨‹å¯åˆªé™¤");
  }

  function addFlightTrip() {
    const list = document.querySelector("#flightTripDisplay .trip-list");
    if (!list) return alert("æ‰¾ä¸åˆ°èˆªç­åˆ—è¡¨");
    
    if (document.getElementById("flightModeToggle").checked) {
      // ç«™é»æ¨¡å¼
      const s = document.getElementById("flightStart").value.trim();
      const e = document.getElementById("flightEnd").value.trim();
      const c = parseInt(document.getElementById("flightCount").value, 10) || 0;
      
      if (!airportCoords[s] || !airportCoords[e] || c <= 0) {
        return alert("è«‹é¸å®Œæ•´æ­£ç¢ºçš„ IATA ä»£ç¢¼ä¸¦è¼¸å…¥è¶Ÿæ•¸");
      }
      
      const dist = parseFloat(haversine(airportCoords[s], airportCoords[e]).toFixed(2));
      const isRound = document.getElementById("roundTripToggle").checked;
      const type = isRound ? "ä¾†å›" : "å–®ç¨‹";
      const multiplier = isRound ? 2 : 1;
      const total = (dist * c * multiplier).toFixed(2);
      
      const item = document.createElement("div");
      makeSelectable(item);
      item.textContent = `${s} â†’ ${e}ï¼š${dist} km Ã— ${c}è¶Ÿ ${type} = ${total} km`;
      list.appendChild(item);
      
      // æ¸…ç©ºè¼¸å…¥æ¬„ä½
      document.getElementById("flightStart").value = "";
      document.getElementById("flightEnd").value = "";
      document.getElementById("flightCount").value = "";
    } else {
      // æ™‚é–“æ¨¡å¼
      const h = parseFloat(document.getElementById("flightTime").value) || 0;
      if (h <= 0) return alert("è«‹è¼¸å…¥æœ‰æ•ˆé£›è¡Œæ™‚æ•¸");
      
      const item = document.createElement("div");
      makeSelectable(item);
      item.textContent = `é£›è¡Œæ™‚æ•¸ï¼š${h} å°æ™‚`;
      list.appendChild(item);
      
      // æ¸…ç©ºè¼¸å…¥æ¬„ä½
      document.getElementById("flightTime").value = "";
    }
  }

  function removeFlightTrip() {
    deleteTrip("#flightTripDisplay");
  }
  </script>

  </body>
</html>
