<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>日常通勤 - 控制顯示模板</title>
    <style>
    /*—— 自訂字體 ——*/
    @font-face {
      font-family: "GenSenRounded2TW-R";
      src: url("font/GenSenRounded2TW-R.otf") format("opentype");
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: "GenSenRounded2TW-L";
      src: url("font/GenSenRounded2TW-L.otf") format("opentype");
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    html {
      font-size: 16px;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: url("images/圖片 1.png") no-repeat center center fixed;
      background-size: cover;
      font-family: "SweiXDPearlCJKtc-DemiLight", sans-serif;
    }

    @media (min-width: 1200px) {
      html {
        font-size: 18px;
      }
    }

    @media (max-width: 480px) {
      html {
        font-size: 14px;
      }
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      font-size: 1rem;
      letter-spacing: 6px;
    }

    .scene {
      display: none;
      flex-direction: column;
      align-items: center;
      width: 900px;
      max-width: 70%;
      padding: 20px;
      min-height: 500px;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 24px;
      box-shadow: -2.5px -2.5px 1.5px 0px #ffffff, 2.5px 2.5px 1.5px 0px #a5a6a85c,
        12px 12px 12px 0px #bbbbbb50;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      position: relative;
      text-align: center;
    }

    .scene.active {
      display: flex;
    }

    h1 {
      font-size: 1.5rem;
      margin-bottom: 14px;
      color: #6c808f;
      font-family: "GenSenRounded2TW-R", sans-serif;
      font-weight: 400;
      letter-spacing: 10px;
      text-shadow: #7f7f7f40 2pt 2pt 3pt;
    }

    /* 換頁按鈕 */
    .nav-btn {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      width: 64px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      color: #b5c1c6;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 50%;
      border: none;
      box-shadow: -4pt -4pt 5pt #ffffff46, 5pt 5pt 10pt #c3cadb76;
      cursor: pointer;
      backdrop-filter: blur(4px);
      transition: background-color 0.25s linear;
      z-index: 1000;
      user-select: none;
    }
    .nav-btn:hover {
      background: #eff3f9;
    }
    .prev-btn {
      left: -100px;
    }
    .next-btn {
      right: -100px;
    }

    @media (max-width: 900px) {
      .nav-btn {
        scale: 0.8;
      }
      .prev-btn {
        left: -40px;
      }
      .next-btn {
        right: -40px;
      }
    }

    /* input 框樣式 */
    .toggle-card input[type="number"],
    .fashion-box input[type="number"] {
      padding: 4px 8px;
      background: #fff;
      color: #4a4a4a;
      text-align: left;
      min-width: 40px;
      max-width: 80px;
      height: 24px;
      border: 0.25pt solid #b5c1c623;
      border-radius: 16px;
      box-shadow: inset 1pt 1pt 4pt #6d808f70;
      outline: none;
    }

    .custom-number-input {
      display: inline-flex;
      align-items: center;
      gap: 12px;
    }

    .custom-number-input input[type="number"]::-webkit-inner-spin-button,
    .custom-number-input input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .custom-number-input button {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      background: none;
      border: none;
      border-radius: 100%;
      background: rgba(255, 255, 255);
      box-shadow: -4pt -4pt 5pt #ffffff46, 5pt 5pt 10pt #c3cadb76;
      width: 20px;
      height: 20px;
      padding: 12px;
      font-size: 1rem;
      color: #b5c1c6;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s;
    }

    .custom-number-input button:hover {
      background-color: #ddd;
    }

    .custom-number-input .btn-decrement {
      position: relative;
      font-size: 1.5rem;
    }

    .custom-number-input .btn-decrement .decrement {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
      /* ---------------------------------------
       3. 場景容器：隱藏/顯示 + 毛玻璃效果
    --------------------------------------- */
      .scene.active {
        display: flex;
      }

      .hidden {
        display: none;
      }
      .inactive {
        opacity: 0.4;
      }

      /* ---------------------------------------
       4. 交通工具選單
    --------------------------------------- */
      .transport-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(120px, 1fr));
        grid-template-rows: repeat(2, auto);
        gap: 20px;
        width: 90%;
        max-width: 700px;
        margin: 16px auto auto;
      }
      .transport-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: rgba(255, 255, 255, 0);
        border-radius: 16px;
        padding: 16px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: transform 0.2s, border-color 0.2s;
      }
      .transport-card img {
        width: 130px;
        height: 130px;
        object-fit: contain;
        margin-bottom: -10px;
      }
      .transport-card .label {
        font-family: "GenSenRounded2TW-R", sans-serif;
        font-size: 24px;
        color: #6d808f;
        text-align: center;
        white-space: nowrap;

        letter-spacing: 6px;
      }
      .transport-card:hover {
        transform: translateY(-4px);
      }
      .transport-card.selected {
        background: rgba(255, 255, 255, 0.4);
      }

      /* ---------------------------------------
       5. 切換開關區塊 (Scene 2 & 4)
    --------------------------------------- */
      .toggle-row {
        display: flex;
        justify-content: center;
        gap: 32px;
        margin: 40px auto;
      }

      .toggle-card {
        height: 50px;
        width: 350px;
        background: rgba(255, 255, 255, 0.4);
        border-radius: 12px;
        padding: 12px 20px;
        display: flex;
        align-items: center;
        box-shadow: -4pt -4pt 5pt #ffffff46, 5pt 5pt 10pt #c3cadb76;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
      }
      .toggle-card span.label {
        font-size: 18px;
        color: #9c7a5c;
        white-space: nowrap;
        margin-right: 50px;
        margin-left: 20px;
        font-family: "GenSenRounded2TW-R", sans-serif;
        letter-spacing: 6px;
      }

      .toggle-switch {
        position: relative;
        width: 40px;
        height: 20px;
        margin: 2px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .toggle-switch .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: #eff3f9;
        border: none;
        box-shadow: inset 1pt 1pt 4pt #6d808f70;
        border-radius: 10px;
        transition: 0.75s;
      }

      .toggle-switch .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 2px;
        bottom: 2px;
        background: #fff;
        border-radius: 50%;
        transition: 0.3s;
        box-shadow: -4pt -4pt 5pt #ffffff46, 5pt 5pt 10pt #c3cadb76;
      }

      .toggle-switch input:checked + .slider {
        background: #eff3f9;
      }
      .toggle-switch input:checked + .slider:before {
        transform: translateX(20px);
      }
      .nowrap-text {
        color: #6c808f;
        white-space: nowrap;
        margin: 0 10px;
        font-family: "GenSenRounded2TW-L", sans-serif;
        letter-spacing: 6px;
      }

      /* 單程／來回純文字＋開關，無背景 */
.simple-toggle {
  display: flex;
  align-items: center;
  gap: 12px;
  /* 不要任何背景、框線或陰影 */
  background: none;
  border: none;
  box-shadow: none;
  padding: 0;
  margin: 16px 12px;
}

.simple-toggle .nowrap-text {
  font-family: "GenSenRounded2TW-R", sans-serif;
  font-size: 15px;
  color: #9c7a5c;
  letter-spacing: 6px;
  white-space: nowrap;
  margin: 0;
}

/* 直接沿用原本的 .toggle-switch 樣式 */
.simple-toggle .toggle-switch {
  margin: 0;
  /* 如果想稍微放大開關可以調整這裡 */
  transform: scale(1.1);
}

      /* ---------------------------------------
       6. 動態模板區域 (Scene 2 & 4)
    --------------------------------------- */
      .template-wrapper {
        height: 200px;
        width: 350px;
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 24px;
        padding: 20px;
        box-shadow: -4pt -4pt 5pt #ffffff46, 5pt 5pt 10pt #c3cadb76;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        margin-bottom: 20px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        transition: cubic-bezier(0.23, 1, 0.320, 1) 0.5s;
      }
      .template-row {
        display: flex;
        gap: 32px;
        justify-content: center;
        margin-bottom: 20px;
      }
      .fuel-group .input-group {
        display: flex;
        align-items: center;
        padding: 10px 0;
      }
      .fuel-group .input-group label {
        margin: 5px 12px;
        font-size: 15px;
        color: #9c7a5c;
        font-family: "GenSenRounded2TW-R", sans-serif;
        letter-spacing: 4px;
        white-space: nowrap;
      }
      .fuel-group .input-group input {
        width: 100px;
        padding: 8px 10px;
        border: 0.25pt solid #b5c1c623;
        border-radius: 8px;
        box-shadow: inset 2pt 2pt 7pt #6d808f70;
        background: #fff;
        font-size: 14px;
        color: #4a4a4a;
      }
      .fuel-group .input-group input[type="number"]::-webkit-outer-spin-button,
      .fuel-group .input-group input[type="number"]::-webkit-inner-spin-button,
      .input-group-MRT input[type="number"]::-webkit-outer-spin-button,
      .input-group-MRT input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      .fuel-group .input-group select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        width: 120px;
        padding: 8px 30px 8px 12px;
        border: 0.25pt solid #b5c1c623;
        border-radius: 8px;
        box-shadow: inset 2pt 2pt 7pt #6d808f70;
        background: #fff url("images/下拉式箭頭.png") no-repeat right center;
        background-size: 30px;
        font-size: 14px;
        color: #4a4a4a;
        font-family: "GenSenRounded2TW-L", sans-serif;
        letter-spacing: 3px;
      }
      .fuel-group .input-group .special-label {
        font-family: "GenSenRounded2TW-L", sans-serif;
        color: #6c808f;
      }
      /* ---------------------------------------
       7. MRT區域 (Scene 2 & 4)
    --------------------------------------- */
      .mrt-trip-list-wrapper {
        display: flex;
        flex-direction: column;
        height: 200px; /* 或你要的固定高度 */
      }
      .mrt-trip-list-wrapper .trip-list {
        flex: 1; /* 滾動區撐滿剩下空間 */
        overflow-y: auto;
      }
      .mrt-trip-list-wrapper .mrt-btn {
        flex: 0 0 auto; /* 按鈕不跟著滾動區縮放 */
        margin-top: 20px;
        align-self: center;
      }
      .input-group-MRT {
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        margin-bottom: 16px;
        gap: 10px;
      }
      .input-group-MRT label {
        margin: 5px 12px;
        font-size: 15px;
        color: #9c7a5c;
        white-space: nowrap;
        font-family: "GenSenRounded2TW-R", sans-serif;
        letter-spacing: 6px;
      }
      .input-group-MRT .special-label {
        color: #6c808f;
      }

      .input-group-MRT select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        width: 100px;
        padding: 8px 30px 8px 12px;
        border: 1px solid rgba(208, 210, 214, 0.6);
        border-radius: 6px;
        background: #fff url("images/下拉式箭頭.png") no-repeat right center;
        background-size: 30px;
        box-shadow: inset 2pt 2pt 7pt #6d808f70;
        font-size: 14px;
        color: #4a4a4a;
      }

      .input-group-MRT input {
        width: 120px;
        padding: 8px 12px;
        border: 0.25pt solid #b5c1c623;
        border-radius: 6px;
        background: #fff;
        font-size: 14px;
        color: #4a4a4a;
        box-shadow: inset 2pt 2pt 7pt #6d808f70;
        font-family: "GenSenRounded2TW-L", sans-serif;
        letter-spacing: 2px;
      }
      #mrtTripDisplay {
        display: flex;
        flex-direction: column;
        /* 保留原本的滾動 */
        overflow-y: auto;
      }
      #mrtTripDisplay .mrt-btn {
        margin-top: 18px;
        align-self: center;
      }
      .trip-item.selected {
        background: rgba(0, 123, 255, 0.1);
        border: 1px solid #007bff;
      }
      /* 讓template-wrapper 靠上對齊 */
      #scene3 .template-row,
      #scene4 .template-wrapper,
      #scene5 .template-wrapper,
      #scene6 .template-wrapper {
        justify-content: flex-start;
      }
      #scene3 .template-row,
      #scene4 .template-row,
      #scene5 .template-row,
      #scene6 .template-row {
        margin: auto 0;
      }
      #scene7 .toggle-row {
        display: flex;
        justify-content: flex-start;  /* 左對齊 */
        gap: 32px;
        margin: 40px 0;               /* 上下 40px，左右 0  */
        width: 100%;                  /* 撐滿容器，才能靠左 */
        padding-left: 85px;           /* 如果想要再往右縮一點，可微調這裡 */
      }
      
      
      /* trip-list */
      .trip-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        font-size: 0.9rem;
        color: #222;
      }
      .add-trip-wrapper {
        display: flex;
        flex-direction: column;
      }
      /* 2) 推按鈕到底部，並置中 */
      .add-trip-wrapper .mrt-btn {
        margin-top: auto;
        align-self: center;
      }
      .mrt-btn {
        width: 200px;
        margin: 0 auto;
        /* 背景色與半透明毛玻璃感 */
        background: rgba(240, 244, 252, 0.8);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        /* 邊框、陰影、圓角 */
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        border-radius: 32px;
        /* 文字大小、顏色、陰影 */
        font-size: 15px;
        font-weight: bold;
        color: rgba(0, 0, 0, 0.2);
        text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        /* 內邊距 & 游標 */
        padding: 6px 12px;
        cursor: pointer;
        transition: background 0.2s, box-shadow 0.2s;
        font-family: "GenSenRounded2TW-R", sans-serif;
      }

      /* 2. 滑鼠懸停效果（選填） */
      .mrt-btn:hover {
        background: rgba(240, 244, 252, 1);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
      }
      

      /* 跳轉橫槓 */

      .page-indicator {
        display: flex;
        justify-content: center;
        width: 60%;
        min-width: 250px;
        gap: 12px;
        margin-top: 10px;
      }

      .bar {
        width: 40%;
        height: 3px;
        background-color: #e4ecf1;
        transition: background-color 0.3s;
        cursor: pointer;
      }

      .bar.active {
        background-color: #b5c1c6;
        box-shadow: 1pt 1pt 4pt #7f7f7f60, -2pt -2pt 3pt #ffffff55;
      }
    </style>
  </head>

  <body>
    <!-- Scene 1: 選車種 -->
    <section id="scene1" class="scene active">
      <h1>日常通勤使用的交通工具</h1>
      <div class="page-indicator">
        <span class="bar active" onclick="goToScene(1)"></span>
        <span class="bar" onclick="goToScene(2)"></span>
        <span class="bar" onclick="goToScene(3)"></span>
        <span class="bar" onclick="goToScene(4)"></span>
        <span class="bar" onclick="goToScene(5)"></span>
        <span class="bar" onclick="goToScene(6)"></span>
        <span class="bar" onclick="goToScene(7)"></span>
      </div>
      <div class="transport-grid">
        <div class="transport-card" onclick="toggleSelection(this,'汽車')">
          <img src="images/汽車.png" alt="汽車" />
          <span class="label">汽車</span>
        </div>
        <div class="transport-card" onclick="toggleSelection(this,'機車')">
          <img src="images/郵輪.png" alt="機車" />
          <span class="label">郵輪</span>
        </div>
        <div class="transport-card" onclick="toggleSelection(this,'公車')">
          <img src="images/飛機.png" alt="公車" />
          <span class="label">飛機</span>
        </div>
        <div class="transport-card" onclick="toggleSelection(this,'捷運')">
          <img src="images/捷運.png" alt="捷運" />
          <span class="label">捷運</span>
        </div>
        <div class="transport-card" onclick="toggleSelection(this,'火車')">
          <img src="images/火車.png" alt="火車" />
          <span class="label">火車</span>
        </div>
        <div class="transport-card" onclick="toggleSelection(this,'高鐵')">
          <img src="images/高鐵.png" alt="高鐵" />
          <span class="label">高鐵</span>
        </div>
      </div>
      <button class="nav-btn prev-btn" onclick="prevTransportScene()">‹</button>
      <button class="nav-btn next-btn" onclick="goToScene(2)">›</button>
    </section>

    <!-- Scene 2: 燃料 & 計算方法 -->
    <section id="scene2" class="scene">
      <h1>汽車使用情況</h1>
      <div class="page-indicator">
        <span class="bar" onclick="goToScene(1)"></span>
        <span class="bar active" onclick="goToScene(2)"></span>
        <span class="bar" onclick="goToScene(3)"></span>
        <span class="bar" onclick="goToScene(4)"></span>
        <span class="bar" onclick="goToScene(5)"></span>
        <span class="bar" onclick="goToScene(6)"></span>
        <span class="bar" onclick="goToScene(7)"></span>
      </div>
      <div class="toggle-row">
        <!-- 燃料開關 -->
        <div class="toggle-card">
          <span class="label">選擇<br />車種燃料</span>
          <span class="nowrap-text">油車</span>
          <label class="toggle-switch">
            <input type="checkbox" id="fuelToggle" />
            <span class="slider"></span>
          </label>
          <span class="nowrap-text">電車</span>
        </div>
        <!-- 方法開關 -->
        <div class="toggle-card">
          <span class="label">選擇<br />計算方法</span>
          <span class="nowrap-text">距離</span>
          <label class="toggle-switch">
            <input type="checkbox" id="methodToggle" />
            <span class="slider"></span>
          </label>
          <span class="nowrap-text">油量</span>
        </div>
      </div>

      <div class="template-row">
        <div id="pane-left" class="template-wrapper">
          <div id="oil-left" class="fuel-group">
            <div class="input-group">
              <label>選擇<br />汽油類型</label>
              <select>
                <option>92無鉛</option>
                <option>95無鉛</option>
                <option>98無鉛</option>
                <option>柴油</option>
              </select>
            </div>
            <div class="input-group">
              <label>每週加油</label>
              <input type="number" />
              <label class="special-label">元 / 週</label>
            </div>
          </div>
          <div id="electric-left" class="fuel-group hidden">
            <div class="input-group">
              <label>行駛里程</label>
              <input type="number" />
              <label class="special-label">公里 / 週</label>
            </div>
          </div>
        </div>

        <div id="pane-right" class="template-wrapper">
          <div id="oil-right" class="fuel-group">
            <div class="input-group">
              <label>選擇<br />汽車類型</label>
              <select>
                <option>小型房車</option>
                <option>中型房車</option>
                <option>大型房車</option>
                <option>小型休旅車</option>
                <option>中型休旅車</option>
                <option>大型休旅車</option>
              </select>
            </div>
            <div class="input-group">
              <label>每週行駛</label>
              <input type="number" />
              <label class="special-label">公里 / 週</label>
            </div>
          </div>
          <div id="electric-right" class="fuel-group hidden">
            <div class="input-group">
              <label>外出充電</label>
              <input type="number" />
              <label class="special-label">kWh / 週</label>
            </div>
          </div>
        </div>
      </div>

      <button class="nav-btn prev-btn" onclick="goToScene(1)">‹</button>
      <button class="nav-btn next-btn" onclick="goToScene(3)">›</button>
    </section>

    <section id="scene3" class="scene">
      <h1>郵輪搭乘情況</h1>
      <div class="page-indicator">
        <span class="bar" onclick="goToScene(1)"></span>
        <span class="bar" onclick="goToScene(2)"></span>
        <span class="bar active" onclick="goToScene(3)"></span>
        <span class="bar" onclick="goToScene(4)"></span>
        <span class="bar" onclick="goToScene(5)"></span>
        <span class="bar" onclick="goToScene(6)"></span>
        <span class="bar" onclick="goToScene(7)"></span>
      </div>

      <div class="template-row">
        <div class="template-wrapper add-trip-wrapper">
          <div class="input-group-MRT">
            <label for="cruiseDays">航行天數</label>
            <input id="cruiseDays" type="number" min="0"/>
            <label>天</label>
          </div>
          <div class="input-group-MRT">
            <label for="stayDays">停留天數</label>
            <input id="stayDays" type="number" min="0"/>
            <label>天</label>
          </div>
          <button id="addCruiseBtn" class="mrt-btn">新增行程</button>
        </div>

        <div class="template-wrapper mrt-trip-list-wrapper" id="cruiseTripDisplay">
          <div class="trip-list"><!-- 這裡會塞 trip-item --></div>
          <button id="removeCruiseBtn" class="mrt-btn">刪除行程</button>
        </div>
      
      <button class="nav-btn prev-btn" onclick="goToScene(2)">‹</button>
      <button class="nav-btn next-btn" onclick="goToScene(4)">›</button>
    </section>
    <!-- 玻璃卡片 -->

    <!-- Scene 4: 捷運使用情況 -->
    <section id="scene4" class="scene">
      <h1>捷運使用情況</h1>
      <div class="page-indicator">
        <span class="bar" onclick="goToScene(1)"></span>
        <span class="bar" onclick="goToScene(2)"></span>
        <span class="bar" onclick="goToScene(3)"></span>
        <span class="bar active" onclick="goToScene(4)"></span>
        <span class="bar" onclick="goToScene(5)"></span>
        <span class="bar" onclick="goToScene(6)"></span>
        <span class="bar" onclick="goToScene(7)"></span>
      </div>
      <div class="template-row">
        <div class="template-wrapper add-trip-wrapper">
          <div class="input-group-MRT">
            <label for="mrtStart">選擇起點</label>
            <input list="mrtStationList" id="mrtStart" />
          </div>
          <div class="input-group-MRT">
            <label for="mrtEnd">選擇訖點</label>
            <input list="mrtStationList" id="mrtEnd" />
            <datalist id="mrtStationList"></datalist>
          </div>
          <div class="input-group-MRT">
            <label for="mrtCount">每月搭乘</label>
            <input id="mrtCount" type="number" min="1" />
            <label class="special-label">趟</label>
          </div>
          <button class="mrt-btn" >新增行程</button>
        </div>

        <!-- 這裡一定要加上 id="mrtTripDisplay" -->
        <div class="template-wrapper mrt-trip-list-wrapper" id="mrtTripDisplay">
          <div class="trip-list"><!-- 這裡會塞 trip-item --></div>
          <button class="mrt-btn">刪除行程</button>
        </div>
      </div>
      <button class="nav-btn prev-btn" onclick="goToScene(3)">‹</button>
      <button class="nav-btn next-btn" onclick="goToScene(5)">›</button>
    </section>

    <!-- Scene 5: 火車使用情況 -->
    <section id="scene5" class="scene">
      <h1>火車使用情況</h1>
      <div class="page-indicator">
        <span class="bar" onclick="goToScene(1)"></span>
        <span class="bar" onclick="goToScene(2)"></span>
        <span class="bar" onclick="goToScene(3)"></span>
        <span class="bar" onclick="goToScene(4)"></span>
        <span class="bar active" onclick="goToScene(5)"></span>
        <span class="bar" onclick="goToScene(6)"></span>
        <span class="bar" onclick="goToScene(7)"></span>
      </div>
      <div class="template-row">
        <div class="template-wrapper add-trip-wrapper">
          <div class="input-group-MRT">
            <label for="trainStart">選擇起點</label>
            <input list="trDistanceMap" id="trainStart" />
          </div>
          <div class="input-group-MRT">
            <label for="trainEnd">選擇訖點</label>
            <input list="trDistanceMap" id="trainEnd" />
            <datalist id="trDistanceMap"></datalist>
          </div>
          <div class="input-group-MRT">
            <label for="trainCount">每月搭乘</label>
            <input id="trainCount" type="number" min="1" />
            <label class="special-label">趟</label>
          </div>
          <button class="mrt-btn">新增行程</button>
        </div>
        <div class="template-wrapper mrt-trip-list-wrapper">
          <div class="trip-list" id="trainTripList"></div>
          <button class="mrt-btn">刪除行程</button>
        </div>
      </div>
      <button class="nav-btn prev-btn" onclick="goToScene(4)">‹</button>
      <button class="nav-btn next-btn" onclick="goToScene(6)">›</button>
    </section>

    <!-- Scene 6: 高鐵使用情況 -->
    <section id="scene6" class="scene">
      <h1>高鐵使用情況</h1>
      <div class="page-indicator">
        <span class="bar" onclick="goToScene(1)"></span>
        <span class="bar" onclick="goToScene(2)"></span>
        <span class="bar" onclick="goToScene(3)"></span>
        <span class="bar" onclick="goToScene(4)"></span>
        <span class="bar" onclick="goToScene(5)"></span>
        <span class="bar active" onclick="goToScene(6)"></span>
        <span class="bar" onclick="goToScene(7)"></span>
      </div>
      <div class="template-row">
        <div class="template-wrapper add-trip-wrapper">
          <div class="input-group-MRT">
            <label for="hsrStart">選擇起點</label>
            <input list="hsrStationList" id="hsrStart" />          
          </div>
          <div class="input-group-MRT">
            <label for="hsrEnd">選擇訖點</label>
            <input list="hsrStationList" id="hsrEnd" />
            <datalist id="hsrStationList"></datalist>
          </div>
          <div class="input-group-MRT">
            <label for="hsrCount">每月搭乘</label>
            <input id="hsrCount" type="number" min="1" />
            <label class="special-label">趟</label>
          </div>
          <button class="mrt-btn">新增行程</button>
        </div>
        <div class="template-wrapper mrt-trip-list-wrapper">
          <div class="trip-list" id="hsrTripList"></div>
          <button class="mrt-btn">刪除行程</button>
        </div>
      </div>
      <button class="nav-btn prev-btn" onclick="goToScene(5)">‹</button>
      <button class="nav-btn next-btn" onclick="goToScene(7)">›</button>
    </section>

    <!-- Scene 7: 飛機使用情況（簡化版） -->
    <section id="scene7" class="scene">
      <h1>飛機搭乘情況</h1>
      <div class="page-indicator">
        <span class="bar" onclick="goToScene(1)"></span>
        <span class="bar" onclick="goToScene(2)"></span>
        <span class="bar" onclick="goToScene(3)"></span>
        <span class="bar" onclick="goToScene(4)"></span>
        <span class="bar" onclick="goToScene(5)"></span>
        <span class="bar" onclick="goToScene(6)"></span>
        <span class="bar active" onclick="goToScene(7)"></span>
      </div>
      <!-- 切換開關 -->
  <div class="toggle-row">
    <div class="toggle-card">
      <span class="label">選擇<br/>計算方式</span>
      <span class="nowrap-text">時間</span>
      <label class="toggle-switch">
        <input type="checkbox" id="flightModeToggle" />
        <span class="slider"></span>
      </label>
      <span class="nowrap-text">站點</span>
    </div>
  </div>

  <div class="template-row">
    <!-- 左半邊：時間 / 站點 -->
    <div class="template-wrapper">
      <!-- 時間模式 -->
      <div id="flight-time" class="flight-group">
        <div class="input-group-MRT">
          <label for="flightTime">飛行時數</label>
          <input id="flightTime" type="number" min="0" />
          <label class="special-label">小時</label>
        </div>
      </div>
      <!-- 站點模式（預設隱藏） -->
      <div id="flight-station" class="flight-group hidden">
        <div class="input-group-MRT">
          <label for="flightStart">起點</label>
          <input list="airportStationList" id="flightStart" />
        </div>
        <div class="input-group-MRT">
          <label for="flightEnd">訖點</label>
          <input list="airportStationList" id="flightEnd" />
          <datalist id="airportStationList"></datalist>
        </div>
        <div class="input-group-MRT">
          <label for="flightCount">趟數</label>
          <input id="flightCount" type="number" min="1" />
        </div>
        <div class="simple-toggle">
          <span class="nowrap-text">單程</span>
          <label class="toggle-switch">
            <input type="checkbox" id="roundTripToggle" />
            <span class="slider"></span>
          </label>
          <span class="nowrap-text">來回</span>
        </div>
        <button class="mrt-btn" id="addFlightBtn">新增航班</button>
      </div>
    </div>

    <!-- 右半邊：行程列表 -->
    <div class="template-wrapper mrt-trip-list-wrapper" id="flightTripDisplay">
      <div class="trip-list"><!-- 這裡會塞 trip-item --></div>
      <button class="mrt-btn" id="removeFlightBtn">刪除行程</button>
    </div>
  </div>
      <button class="nav-btn prev-btn" onclick="goToScene(6)">‹</button>
      <button class="nav-btn next-btn" onclick="goToScene(1)">›</button>
    </section>

   <script>
// 記錄選擇的交通工具
const selectedTransport = [];
function toggleSelection(card, type) {
  card.classList.toggle("selected");
  const idx = selectedTransport.indexOf(type);
  if (idx > -1) selectedTransport.splice(idx, 1);
  else selectedTransport.push(type);
}

// 場景切換
let currentScene = 1;
function goToScene(n) {
  document.getElementById(`scene${currentScene}`).classList.remove("active");
  document.getElementById(`scene${n}`).classList.add("active");
  currentScene = n;
}
function prevTransportScene() {
  goToScene(currentScene === 1 ? 7 : currentScene - 1);
}

// 汽車 & 計算方法切換（Scene 2）
function setupToggle(fuelId, methodId, oilLeftId, oilRightId, elecLeftId, elecRightId, paneLeftId, paneRightId) {
  const fuelToggle   = document.getElementById(fuelId);
  const methodToggle = document.getElementById(methodId);
  const oilLeft      = document.getElementById(oilLeftId);
  const oilRight     = document.getElementById(oilRightId);
  const elecLeft     = document.getElementById(elecLeftId);
  const elecRight    = document.getElementById(elecRightId);
  const paneLeft     = document.getElementById(paneLeftId);
  const paneRight    = document.getElementById(paneRightId);

  function updateFuel() {
    const isElec = fuelToggle.checked;
    oilLeft.classList.toggle("hidden", isElec);
    oilRight.classList.toggle("hidden", isElec);
    elecLeft.classList.toggle("hidden", !isElec);
    elecRight.classList.toggle("hidden", !isElec);
  }
  function updateMethod() {
    const isVol = methodToggle.checked;
    paneLeft.classList.toggle("inactive", isVol);
    paneRight.classList.toggle("inactive", !isVol);
  }
  fuelToggle.addEventListener("change", () => { updateFuel(); updateMethod(); });
  methodToggle.addEventListener("change", updateMethod);
  updateFuel();
  updateMethod();
}

// 飛機大圓距離
function haversine(a, b) {
  const toRad = x => x * Math.PI / 180;
  const R = 6371;
  const dLat = toRad(b.lat - a.lat);
  const dLon = toRad(b.lng - a.lng);
  const lat1 = toRad(a.lat), lat2 = toRad(b.lat);
  const h = Math.sin(dLat/2)**2 + Math.sin(dLon/2)**2 * Math.cos(lat1) * Math.cos(lat2);
  return 2 * R * Math.asin(Math.sqrt(h));
}

// 全域資料
let airportCoords   = {},
    mrtDistanceMap  = {},
    trDistanceMap   = {},
    hsrDistanceMap  = {};

document.addEventListener("DOMContentLoaded", () => {
  // 1. 載入機場座標 JSON
  fetch("/data/AirportDistanceMap.json")
    .then(r => r.json())
    .then(data => {
      const dl = document.getElementById("airportStationList");
      data.forEach(({ iata_code, latitude_deg, longitude_deg }) => {
        airportCoords[iata_code] = { lat: latitude_deg, lng: longitude_deg };
        const o = document.createElement("option");
        o.value = iata_code;
        dl.appendChild(o);
      });
    })
    .catch(console.error);

  // 2. 載入捷運距離表
  fetch("/data/mrtDistanceMap.json")
    .then(r => r.json())
    .then(data => {
      mrtDistanceMap = data;
      const dl = document.getElementById("mrtStationList");
      new Set(Object.keys(data).flatMap(k => k.split("_"))).forEach(st => {
        const o = document.createElement("option");
        o.value = st;
        dl.appendChild(o);
      });
    })
    .catch(console.error);

  // 3. 載入火車距離表
  fetch("/data/trDistanceMap.json")
    .then(r => r.json())
    .then(data => {
      trDistanceMap = data;
      const dl = document.getElementById("trDistanceMap");
      Object.keys(data).forEach(st => {
        const o = document.createElement("option");
        o.value = st;
        dl.appendChild(o);
      });
    })
    .catch(console.error);

  // 4. 載入高鐵距離表
  fetch("/data/hsrDistanceMap.json")
    .then(r => r.json())
    .then(data => {
      hsrDistanceMap = data;
      const dl = document.getElementById("hsrStationList");
      new Set(Object.keys(data).flatMap(k => k.split("_"))).forEach(st => {
        const o = document.createElement("option");
        o.value = st;
        dl.appendChild(o);
      });
    })
    .catch(console.error);

  // 5. 初始化汽車燃料 & 計算方法切換 (Scene 2)
  setupToggle(
    "fuelToggle", "methodToggle",
    "oil-left", "oil-right",
    "electric-left", "electric-right",
    "pane-left", "pane-right"
  );

  // 6. 飛機模式切換 (Scene 7)
  const modeToggle = document.getElementById("flightModeToggle");
  const timeGroup  = document.getElementById("flight-time");
  const staGroup   = document.getElementById("flight-station");
  modeToggle.addEventListener("change", () => {
    const isStation = modeToggle.checked;
    staGroup.classList.toggle("hidden", !isStation);
    timeGroup.classList.toggle("hidden", isStation);
  });

  // 7. 綁定「新增」與「刪除」按鈕
  // 郵輪
  document.getElementById("addCruiseBtn").addEventListener("click", addCruiseTrip);
  document.getElementById("removeCruiseBtn").addEventListener("click", removeCruiseTrip);

  // 捷運 (Scene 4)
  const mrtBtns = document.querySelectorAll("#scene4 .mrt-btn");
  mrtBtns[0].addEventListener("click", addMRTTrip);
  mrtBtns[1].addEventListener("click", removeMRTTrip);

  // 火車 (Scene 5)
  const trainBtns = document.querySelectorAll("#scene5 .mrt-btn");
  trainBtns[0].addEventListener("click", addTrainTrip);
  trainBtns[1].addEventListener("click", removeTrainTrip);

  // 高鐵 (Scene 6)
  const hsrBtns = document.querySelectorAll("#scene6 .mrt-btn");
  hsrBtns[0].addEventListener("click", addHsrTrip);
  hsrBtns[1].addEventListener("click", removeHsrTrip);

  // 飛機 (Scene 7)
  document.getElementById("addFlightBtn").addEventListener("click", addFlightTrip);
  document.getElementById("removeFlightBtn").addEventListener("click", removeFlightTrip);

  // 8. 為所有 trip-list 加上「點擊選取」功能
  const bindSelection = (containerSelector) => {
    const container = document.querySelector(containerSelector);
    container.addEventListener("click", e => {
      const item = e.target.closest(".trip-item");
      if (!item) return;
      // 清除同容器內其他選取
      container.querySelectorAll(".trip-item").forEach(el => el.classList.remove("selected"));
      // Toggle 選取狀態
      item.classList.toggle("selected");
    });
  };
  bindSelection("#cruiseTripDisplay .trip-list");
  bindSelection("#mrtTripDisplay .trip-list");
  bindSelection("#trainTripList");
  bindSelection("#hsrTripList");
  bindSelection("#flightTripDisplay .trip-list");
});

// ===== 新增 & 刪除行程 =====

function addCruiseTrip() {
  const sail = parseInt(document.getElementById("cruiseDays").value,10)||0;
  const stay = parseInt(document.getElementById("stayDays").value,10)||0;
  if (sail<0||stay<0) return alert("天數不能是負數");
  const total = sail+stay;
  const item = document.createElement("div"); item.className="trip-item";
  item.textContent = `搭:${total} 天／停:${stay} 天／航:${sail} 天`;
  document.querySelector("#cruiseTripDisplay .trip-list").appendChild(item);
}
function removeCruiseTrip() {
  const list = document.querySelector("#cruiseTripDisplay .trip-list");
  const sel  = list.querySelector(".trip-item.selected");
  if (sel) sel.remove();
  else if (list.lastElementChild) list.removeChild(list.lastElementChild);
  else alert("沒有行程可刪除");
}

function addMRTTrip() {
  const s   = document.getElementById("mrtStart").value;
  const e   = document.getElementById("mrtEnd").value;
  const c   = parseInt(document.getElementById("mrtCount").value,10)||0;
  const dist= mrtDistanceMap[`${s}_${e}`];
  if (dist===undefined||c<=0) return alert("請選完整正確的 起點／訖點 並輸入趟數");
  const total=(dist*c).toFixed(2);
  const item=document.createElement("div"); item.className="trip-item";
  item.textContent=`${s}→${e}：${dist} km ×${c} = ${total} km`;
  document.querySelector("#mrtTripDisplay .trip-list").appendChild(item);
}
function removeMRTTrip() {
  const list = document.querySelector("#mrtTripDisplay .trip-list");
  const sel  = list.querySelector(".trip-item.selected");
  if (sel) sel.remove();
  else if (list.lastElementChild) list.removeChild(list.lastElementChild);
  else alert("沒有行程可刪除");
}

function addTrainTrip() {
  const s = document.getElementById("trainStart").value;
  const e = document.getElementById("trainEnd").value;
  const c = parseInt(document.getElementById("trainCount").value,10)||0;
  const d1= trDistanceMap[s], d2= trDistanceMap[e];
  if (d1===undefined||d2===undefined||c<=0) return alert("請選正確的起點／訖點 並輸入趟數");
  const dist = Math.abs(d2-d1).toFixed(2);
  const total= (dist*c).toFixed(2);
  const item=document.createElement("div"); item.className="trip-item";
  item.textContent=`${s}→${e}：${dist} km ×${c} = ${total} km`;
  document.getElementById("trainTripList").appendChild(item);
}
function removeTrainTrip() {
  const list = document.getElementById("trainTripList");
  const sel  = list.querySelector(".trip-item.selected");
  if (sel) sel.remove();
  else if (list.lastElementChild) list.removeChild(list.lastElementChild);
  else alert("沒有行程可刪除");
}

function addHsrTrip() {
  const s   = document.getElementById("hsrStart").value;
  const e   = document.getElementById("hsrEnd").value;
  const c   = parseInt(document.getElementById("hsrCount").value,10)||0;
  const dist= hsrDistanceMap[`${s}_${e}`];
  if (dist===undefined||c<=0) return alert("請選完整正確的 起點／訖點 並輸入有效趟數");
  const total=(dist*c).toFixed(2);
  const item=document.createElement("div"); item.className="trip-item";
  item.textContent=`${s}→${e}：${dist} kg ×${c} = ${total} kg`;
  document.getElementById("hsrTripList").appendChild(item);
}
function removeHsrTrip() {
  const list = document.getElementById("hsrTripList");
  const sel  = list.querySelector(".trip-item.selected");
  if (sel) sel.remove();
  else if (list.lastElementChild) list.removeChild(list.lastElementChild);
  else alert("沒有行程可刪除");
}

function addFlightTrip() {
  const list = document.querySelector("#flightTripDisplay .trip-list");
  if (document.getElementById("flightModeToggle").checked) {
    // 站點模式
    const s = document.getElementById("flightStart").value;
    const e = document.getElementById("flightEnd").value;
    const c = parseInt(document.getElementById("flightCount").value, 10) || 0;
    if (!airportCoords[s] || !airportCoords[e] || c <= 0) {
      return alert("請選完整正確的 IATA 代碼 並輸入趟數");
    }
    const dist = parseFloat(haversine(airportCoords[s], airportCoords[e]).toFixed(2));
    const isRound = document.getElementById("roundTripToggle").checked;
    const type = isRound ? "來回" : "單程";
    // 如果是「來回」，單次距離要乘 2
    const multiplier = isRound ? 2 : 1;
    const total = (dist * c * multiplier).toFixed(2);
    const item = document.createElement("div");
    item.className = "trip-item";
    item.textContent = `${s}→${e}：${dist} km ×${c} ×${multiplier} = ${total} km (${type})`;
    list.appendChild(item);
  } else {
    // 時間模式
    const h = parseFloat(document.getElementById("flightTime").value) || 0;
    if (h <= 0) return alert("請輸入有效飛行時數");
    const item = document.createElement("div");
    item.className = "trip-item";
    item.textContent = `飛行時數：${h} 小時`;
    list.appendChild(item);
  }
}
function removeFlightTrip() {
  const list = document.querySelector("#flightTripDisplay .trip-list");
  const sel  = list.querySelector(".trip-item.selected");
  if (sel) sel.remove();
  else if (list.lastElementChild) list.removeChild(list.lastElementChild);
  else alert("沒有行程可刪除");
}
</script>
  </body>
</html>
