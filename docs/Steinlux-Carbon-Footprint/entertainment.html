<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>æ—¥å¸¸å¨›æ¨‚</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/all.css" />
    <link rel="stylesheet" href="css/story.css" />
    <style>
      /* ç¬¬ä¸€é  */
      .scene-1 .entertain-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(120px, 1fr));
        grid-template-rows: repeat(2, auto);
        gap: 1rem;
        width: 90%;
        max-width: 700px;
        margin: 0 auto;
      }

      .scene-1 .entertain-card {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: rgba(255, 255, 255, 0);
        border-radius: 16px;
        cursor: pointer;
        transition: transform 0.2s, border-color 0.2s;
      }

      .scene-1 .entertain-card img {
        width: 120px;
        height: 120px;
        object-fit: contain;
        margin-bottom: -10px;
      }

      .scene-1 .entertain-card .label {
        font-family: "GenSenRounded2TW-R", sans-serif;
        font-size: 1.2rem;
        color: #6d808f;
        text-align: center;
        white-space: nowrap;
        letter-spacing: 6px;
      }

      .scene-1 .entertain-card:hover {
        transform: translateY(-2px);
      }
      .scene-1 .entertain-card.selected {
        background: rgba(255, 255, 255, 0.4);
      }

      /* ç¬¬äºŒé  */

      .custom-number-input {
        flex-wrap: wrap;
        justify-content: center;
      }

      .scene-2 .entertain-card {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        width: 100%;
        gap: 32px;
      }

      .scene-2 .entertain-card .toggle-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: start;
        background: rgba(255, 255, 255, 0.4);
        border-radius: 16px;
        padding: 24px 32px;
        gap: 16px;
        box-shadow: -4pt -4pt 5pt #ffffff46, 5pt 5pt 10pt #c3cadb76;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
      }

      .scene-2 .entertain-card .toggle-card-1 {
        width: 20%;
      }

      .scene-2 .entertain-card .toggle-card-2 {
        width: 40%;
      }

      .streaming-toggle-container {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        gap: 32px;
      }

      .streaming-toggle-card-1,
      .streaming-toggle-card-2 {
        width: 80%;
      }

      .scene-2 .entertain-card .streaming-toggle-card-3 {
        display: flex;
        justify-content: center;
      }

      .scene-2 .toggle-card .question-title {
        font-family: "GenSenRounded2TW-R", sans-serif;
        color: #9c7a5c;
        line-height: 1.2;
        white-space: nowrap;
      }

      .scene-2 .toggle-card .question-unit {
        font-family: "GenSenRounded2TW-L", sans-serif;
        font-weight: normal;
        color: #6c808f;
      }

      .scene-2 .toggle-card .label {
        color: #444;
        user-select: none;
        margin-top: 8px;
      }

      /* å–®ä½åˆ‡æ›æ’åˆ— */
      .scene-2 .toggle-card .toggle-row {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
      }

      /* å–®ä½æ–‡å­—é¿å…æ–·è¡Œ */
      .nowrap-text {
        color: #6c808f;
        white-space: nowrap;
        font-family: "GenSenRounded2TW-L", sans-serif;
        letter-spacing: 6px;
      }

      @media (min-width: 320px) and (max-width: 600px) {
        .scene-1 .entertain-grid {
          grid-template-columns: repeat(2, minmax(80px, 1fr));
          grid-template-rows: repeat(3, auto);
        }
      }

      @media (min-width: 600px) and (max-width: 900px) {
        .scene-1 .entertain-grid {
          grid-template-columns: repeat(2, minmax(120px, 1fr));
          grid-template-rows: repeat(3, auto);
        }
      }

      @media (max-width: 600px) {
        .scene-2 .entertain-card .toggle-card-1 {
          flex-direction: column;
          justify-content: center;
        }

        .scene-2 .entertain-card .toggle-card-2 {
          padding: 32px 16px;
        }
        .scene-1 .entertain-card img {
          width: 80px;
          height: 80px;
        }
      }

      @media (max-width: 900px) {
        .scene-2 .entertain-card .toggle-card {
          width: 100%;
          justify-content: space-around;
        }
      }

      @media (max-width: 1024px) {
        .streaming .entertain-card .toggle-card {
          width: 80%;
          justify-content: center;
        }

        .streaming-toggle-container {
          width: 100%;
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
  <svg style="display: none">
    <filter id="glass-distortion" x="0%" y="0%" width="100%" height="100%" filterUnits="objectBoundingBox">
      <feTurbulence type="fractalNoise" baseFrequency="0.01 0.01" numOctaves="1" seed="5" result="turbulence" />

      <feComponentTransfer in="turbulence" result="mapped">
        <feFuncR type="gamma" amplitude="1" exponent="10" offset="0.5" />
        <feFuncG type="gamma" amplitude="0" exponent="1" offset="0" />
        <feFuncB type="gamma" amplitude="0" exponent="1" offset="0.5" />
      </feComponentTransfer>

      <feGaussianBlur in="turbulence" stdDeviation="3" result="softMap" />

      <feSpecularLighting in="softMap" surfaceScale="5" specularConstant="1" specularExponent="100"
        lighting-color="white" result="specLight">
        <fePointLight x="-200" y="-200" z="300" />
      </feSpecularLighting>

      <feComposite in="specLight" operator="arithmetic" k1="0" k2="1" k3="1" k4="0" result="litImage" />

      <feDisplacementMap in="SourceGraphic" in2="softMap" scale="150" xChannelSelector="R" yChannelSelector="G" />
    </filter>
  </svg>

    <!-- æ•…äº‹åŠ‡æƒ… -->
    <div class="story-body">
      <div class="story-container">
        <header class="story-header">
          <div class="story-header-title">
            <div class="story-header-title-lt">
              <div class="story-header-profile-photo"></div>
              <h1>Neo(2)</h1>
              <i class="fa-solid fa-volume-low" style="color: #6c808f;"></i>
            </div>
            <div class="story-header-title-rt">
              <i class="fa-solid fa-phone"></i>
              <i class="fa-solid fa-ellipsis-vertical"></i>
            </div>
          </div>
        </header>

        <div class="story-chat-container" id="chatContainer"></div>

        <div class="input-container">
          <div class="input-wrapper">
            <input
              type="text"
              class="message-input"
              placeholder="è«‹è¼¸å…¥è¨Šæ¯..."
              aria-label="Message input"
            />
            <div class="action-buttons">
              <button id="send-button" class="send-button">
                <span>å‡ºç™¼</span>
                <i class="fa-regular fa-font-awesome"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="carbon-ring-container">
      <div class="carbon-ring">
        <svg width="200" height="200">
          <circle
            cx="100"
            cy="100"
            r="80"
            stroke="transparent"
            stroke-width="12"
            fill="none"
          />
          <circle
            cx="100"
            cy="100"
            r="80"
            stroke="#ff7043"
            stroke-width="10"
            fill="transparent"
            stroke-linecap="round"
            stroke-dasharray="270 107"
            stroke-dashoffset="43"
          />
        </svg>
        <div class="text">
          ç´¯ç©ç¢³æ’<br />
          <span>123 kgCOâ‚‚</span>
        </div>
      </div>
      <div class="carbon-temperature">
        <span>Now 4åº¦C</span>
      </div>
    </div>
    <!-- Scene 1: é¸å¨›æ¨‚æ´»å‹• -->
    <section id="scene-entertain-1" class="scene scene-1">
      <Chapter-Bar></Chapter-Bar>
      <div class="slideContainer">
        <h1>æ—¥å¸¸ç”Ÿæ´»ä¸­æœ‰å“ªäº›å¨›æ¨‚æ´»å‹•ï¼Ÿ</h1>
        <div class="page-indicator">
          <div class="bar-container dynamic-bar-container"></div>
        </div>
        <div class="entertain-grid">
          <div class="entertain-card" onclick="toggleActivity(this,'KTV')">
            <img src="images/å…¬è»Š.png" alt="KTV" /><span class="label">KTV</span>
          </div>
          <div class="entertain-card" onclick="toggleActivity(this,'é›»å½±')">
            <img src="images/å…¬è»Š.png" alt="é›»å½±" /><span class="label"
              >é›»å½±</span
            >
          </div>
          <div class="entertain-card" onclick="toggleActivity(this,'å¥èº«æˆ¿')">
            <img src="images/å…¬è»Š.png" alt="å¥èº«æˆ¿" /><span class="label"
              >å¥èº«æˆ¿</span
            >
          </div>
          <div class="entertain-card" onclick="toggleActivity(this,'æ—…éŠä½å®¿')">
            <img src="images/å…¬è»Š.png" alt="æ—…éŠä½å®¿" /><span class="label"
              >æ—…éŠä½å®¿</span
            >
          </div>
          <div class="entertain-card" onclick="toggleActivity(this,'å½±éŸ³ä¸²æµ')">
            <img src="images/å…¬è»Š.png" alt="å½±éŸ³ä¸²æµ" /><span class="label"
              >å½±éŸ³ä¸²æµ</span
            >
          </div>
          <div class="entertain-card" onclick="toggleActivity(this,'å®—æ•™ä¿¡ä»°')">
            <img src="images/å…¬è»Š.png" alt="å®—æ•™ä¿¡ä»°" /><span class="label"
              >å®—æ•™ä¿¡ä»°</span
            >
          </div>
        </div>
      </div>
      <button
        class="nav-btn prev-btn"
        onclick="window.location.href='fashion.html'"
      >
        â€¹
      </button>
      <!-- ç¬¬ä¸€é ä¸‹ä¸€é æŒ‰éˆ• -->
      <button class="nav-btn next-btn" onclick="handleFirstSceneNext()">
        â€º
      </button>
    </section>

    <!-- Scene 1ï¼šKTV -->
    <section id="scene-entertain-2-1" class="scene scene-2 KTV">
      <Chapter-Bar></Chapter-Bar>
      <div class="slideContainer">
        <h1>æ—¥å¸¸ç”Ÿæ´»ä¸­å»KTVé »ç‡ï¼Ÿ</h1>
        <div class="page-indicator">
          <div class="bar-container dynamic-bar-container"></div>
        </div>
        <div class="entertain-card">
          <div class="toggle-card toggle-card-1">
            <span class="question-title">æ™‚é–“å–®ä½</span>
            <div class="toggle-row">
              <span class="nowrap-text">æœˆ</span>
              <label class="toggle-switch">
                <input type="checkbox" />
                <span class="slider"></span>
              </label>
              <span class="nowrap-text">å¹´</span>
            </div>
          </div>
          <div class="toggle-card toggle-card-2">
            <span class="question-title" data-template="æ¯{unit}å»KTV"
              >æ¯æœˆå»KTV</span
            >
            <div class="custom-number-input">
              <button type="button" class="btn-decrement">
                <span class="decrement">-</span>
              </button>
              <input type="number" value="0" min="0" />
              <button type="button" class="btn-increment">
                <span class="increment">+</span>
              </button>
              <span class="question-unit question-title" data-template="æ¬¡/{unit}"
                >æ¬¡/æœˆ</span
              >
            </div>
          </div>
        </div>
      </div>
      <button class="nav-btn prev-btn" onclick="goToPrevScene()">â€¹</button>
      <button class="nav-btn next-btn" onclick="goToNextScene()">â€º</button>
    </section>

    <!-- Scene 2ï¼šé›»å½±é™¢ -->
    <section id="scene-entertain-2-2" class="scene scene-2 Cinema">
      <Chapter-Bar></Chapter-Bar>
      <div class="slideContainer">
        <h1>æ—¥å¸¸ç”Ÿæ´»ä¸­åˆ°é›»å½±é™¢è§€å½±é »ç‡ï¼Ÿ</h1>
        <div class="page-indicator">
          <div class="bar-container dynamic-bar-container"></div>
        </div>
        <div class="entertain-card">
          <div class="toggle-card toggle-card-1">
            <span class="question-title">æ™‚é–“å–®ä½</span>
            <div class="toggle-row">
              <span class="nowrap-text">æœˆ</span>
              <label class="toggle-switch">
                <input type="checkbox" />
                <span class="slider"></span>
              </label>
              <span class="nowrap-text">å¹´</span>
            </div>
          </div>
          <div class="toggle-card toggle-card-2">
            <span class="question-title" data-template="æ¯{unit}å»é›»å½±é™¢"
              >æ¯æœˆå»é›»å½±é™¢</span
            >
            <div class="custom-number-input">
              <button type="button" class="btn-decrement">
                <span class="decrement">-</span>
              </button>
              <input type="number" value="0" min="0" />
              <button type="button" class="btn-increment">
                <span class="increment">+</span>
              </button>
              <span class="question-unit question-title" data-template="æ¬¡/{unit}"
                >æ¬¡/æœˆ</span
              >
            </div>
          </div>
        </div>
      </div>
      <button class="nav-btn prev-btn" onclick="goToPrevScene()">â€¹</button>
      <button class="nav-btn next-btn" onclick="goToNextScene()">â€º</button>
    </section>

    <!-- Scene 3ï¼šå¥èº«æˆ¿ -->
    <section id="scene-entertain-2-3" class="scene scene-2 gym">
      <Chapter-Bar></Chapter-Bar>
      <div class="slideContainer">
        <h1>æ—¥å¸¸ç”Ÿæ´»ä¸­åˆ°å¥èº«æˆ¿å¥èº«é »ç‡ï¼Ÿ</h1>
        <div class="page-indicator">
          <div class="bar-container dynamic-bar-container"></div>
        </div>
          <div class="entertain-card">
          <div class="toggle-card toggle-card-1">
            <span class="question-title">æ™‚é–“å–®ä½</span>
            <div class="toggle-row">
              <span class="nowrap-text">é€±</span>
              <label class="toggle-switch">
                <input type="checkbox" />
                <span class="slider"></span>
              </label>
              <span class="nowrap-text">æœˆ</span>
            </div>
          </div>
          <div class="toggle-card toggle-card-2">
            <span class="question-title" data-template="æ¯{unit}å»å¥èº«æˆ¿"
              >æ¯é€±å»å¥èº«æˆ¿</span
            >
            <div class="custom-number-input">
              <button type="button" class="btn-decrement">
                <span class="decrement">-</span>
              </button>
              <input type="number" value="0" min="0" />
              <button type="button" class="btn-increment">
                <span class="increment">+</span>
              </button>
              <span class="question-unit question-title" data-template="æ¬¡/{unit}"
                >æ¬¡/é€±</span
              >
            </div>
          </div>
          </div>
      </div>
      <button class="nav-btn prev-btn" onclick="goToPrevScene()">â€¹</button>
      <button class="nav-btn next-btn" onclick="goToNextScene()">â€º</button>
    </section>

    <!-- Scene 4ï¼šé£¯åº— -->
    <section id="scene-entertain-2-4" class="scene scene-2 hotel">
      <Chapter-Bar></Chapter-Bar>
      <div class="slideContainer">
        <h1>æ—¥å¸¸ç”Ÿæ´»ä¸­ä½é£¯åº—é »ç‡ï¼Ÿ</h1>
        <div class="page-indicator">
          <div class="bar-container dynamic-bar-container"></div>
        </div>
        <div class="entertain-card">
          <div class="toggle-card toggle-card-1">
            <span class="question-title">æ™‚é–“å–®ä½</span>
            <div class="toggle-row">
              <span class="nowrap-text">æœˆ</span>
              <label class="toggle-switch">
                <input type="checkbox" />
                <span class="slider"></span>
              </label>
              <span class="nowrap-text">å¹´</span>
            </div>
          </div>
          <div class="toggle-card toggle-card-2">
            <span class="question-title" data-template="æ¯{unit}å»ä½é£¯åº—"
              >æ¯æœˆå»ä½é£¯åº—</span
            >
            <div class="custom-number-input">
              <button type="button" class="btn-decrement">
                <span class="decrement">-</span>
              </button>
              <input type="number" value="0" min="0" />
              <button type="button" class="btn-increment">
                <span class="increment">+</span>
              </button>
              <span class="question-unit question-title" data-template="æ¬¡/{unit}"
                >æ¬¡/æœˆ</span
              >
            </div>
          </div>
        </div>
      </div>
      <button class="nav-btn prev-btn" onclick="goToPrevScene()">â€¹</button>
      <button class="nav-btn next-btn" onclick="goToNextScene()">â€º</button>
    </section>

    <!-- Scene 5ï¼šç¶²è·¯æµé‡ -->
    <section id="scene-entertain-2-5" class="scene scene-2 streaming">
      <Chapter-Bar></Chapter-Bar>
      <div class="slideContainer">
        <h1>æ—¥å¸¸ç”Ÿæ´»ä¸­ä½¿ç”¨å¤šå°‘ä¸²æµå’Œç¶²è·¯æµé‡ï¼Ÿ</h1>
        <div class="page-indicator">
          <div class="bar-container dynamic-bar-container"></div>
        </div>
        <div class="entertain-card">
          <div class="toggle-card streaming-toggle-card-3">
            <span class="question-title">æ¯æœˆä½¿ç”¨ç¶²è·¯æµé‡(GB)</span>
            <div class="custom-number-input">
              <button type="button" class="btn-decrement">
                <span class="decrement">-</span>
              </button>
              <input type="number" value="0" min="0" />
              <button type="button" class="btn-increment">
                <span class="increment">+</span>
              </button>
            </div>
          </div>

          <div class="toggle-container streaming-toggle-container">
            <div class="toggle-card streaming-toggle-card-1">
              <span class="question-title">æ™‚é–“å–®ä½</span>
              <div class="toggle-row">
                <span class="nowrap-text">å¤©</span>
                <label class="toggle-switch">
                  <input type="checkbox" />
                  <span class="slider"></span>
                </label>
                <span class="nowrap-text">å‘¨</span>
              </div>
            </div>

            <div class="toggle-card streaming-toggle-card-2">
              <span class="question-title" data-template="æ¯{unit}ä½¿ç”¨ä¸²æµå½±éŸ³">
                æ¯å¤©ä½¿ç”¨ä¸²æµå½±éŸ³
              </span>
              <div class="custom-number-input">
                <button type="button" class="btn-decrement">
                  <span class="decrement">-</span>
                </button>
                <input type="number" value="0" min="0" />
                <button type="button" class="btn-increment">
                  <span class="increment">+</span>
                </button>
                <span
                  class="question-unit question-title"
                  data-template="å°æ™‚/{unit}"
                >
                  å°æ™‚/å¤©
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <button class="nav-btn prev-btn" onclick="goToPrevScene()">â€¹</button>
      <button class="nav-btn next-btn" onclick="goToNextScene()">â€º</button>
    </section>

    <!-- Scene 6ï¼šå®—æ•™æ´»å‹• -->
    <section id="scene-entertain-2-6" class="scene scene-2 religion">
      <Chapter-Bar></Chapter-Bar>
      <div class="slideContainer">
        <h1>æ—¥å¸¸ç”Ÿæ´»ä¸­åƒèˆ‡å®—æ•™æ´»å‹•é »ç‡ï¼Ÿ</h1>
        <div class="page-indicator">
          <div class="bar-container dynamic-bar-container"></div>
        </div>
        <div class="entertain-card">
          <div class="toggle-card toggle-card-1">
            <span class="question-title">æ™‚é–“å–®ä½</span>
            <div class="toggle-row">
              <span class="nowrap-text">é€±</span>
              <label class="toggle-switch">
                <input type="checkbox" />
                <span class="slider"></span>
              </label>
              <span class="nowrap-text">æœˆ</span>
            </div>
          </div>
          <div class="toggle-card toggle-card-2">
            <span class="question-title" data-template="æ¯{unit}ä½¿ç”¨é‡‘ç´™"
              >æ¯å‘¨ä½¿ç”¨é‡‘ç´™ï¼Ÿ</span
            >
            <div class="custom-number-input">
              <button type="button" class="btn-decrement">
                <span class="decrement">-</span>
              </button>
              <input type="number" value="0" min="0" />
              <button type="button" class="btn-increment">
                <span class="increment">+</span>
              </button>
              <span class="question-unit question-title" data-template="ä»½/{unit}"
                >æ¬¡/é€±</span
              >
            </div>
          </div>
        </div>
      </div>
      <button class="nav-btn prev-btn" onclick="goToPrevScene()">â€¹</button>
      <button class="nav-btn next-btn" onclick="goToNextScene()">â€º</button>

      <!-- Info æŒ‰éˆ• -->
      <button id="info-btn" class="info-btn">
        <img src="images/info.png" alt="!" />
      </button>

      <!-- å½ˆè·³å¼è¦–çª— -->
      <div id="modal" class="modal">
        <span id="modal-close" class="modal-close">&times;</span>
        <div class="modal-body">
          <span>é‡‘ç´™ä¸€ä»½ç‚º500å…‹</span>
        </div>
      </div>
    </section>

    <script src="./js/all.js"></script>
    <script>

      /* åˆ‡æ›é é¢ */

      let currentScene = "scene-entertain-1";

      function goToNextScene() {
        // å–å¾—ç›®å‰å ´æ™¯åœ¨ä½¿ç”¨è€…é¸å–æ´»å‹•ä¸­çš„ä½ç½®
        const currentIndex = selectedActivities.findIndex(
          (activity) => activityScenes[activity] === currentScene
        );

        // æ˜¯æœ€å¾Œä¸€å€‹å ´æ™¯ â†’ å°å‘çµæœé 
        if (currentIndex === selectedActivities.length - 1) {
          window.location.href = "analysis.html";
          return;
        }

        // é‚„æœ‰ä¸‹ä¸€é  â†’ å–å¾—ä¸‹ä¸€å€‹æ´»å‹•çš„ sceneIdï¼Œè·³è½‰
        const nextActivity = selectedActivities[currentIndex + 1];
        const nextSceneId = activityScenes[nextActivity];
        if (nextSceneId) {
          goToScene(nextSceneId);
        }
      }

      function goToPrevScene() {
        const currentIndex = selectedActivities.findIndex(
          (activity) => activityScenes[activity] === currentScene
        );

        // æ˜¯ç¬¬ä¸€å€‹é¸æ“‡çš„æ´»å‹• â†’ å›åˆ° scene-entertain-1
        if (currentIndex === 0) {
          goToScene("scene-entertain-1");
          return;
        }

        // é‚„æœ‰ä¸Šä¸€é  â†’ è·³åˆ°ä¸Šä¸€å€‹æ´»å‹•é é¢
        const prevActivity = selectedActivities[currentIndex - 1];
        const prevSceneId = activityScenes[prevActivity];
        if (prevSceneId) {
          goToScene(prevSceneId);
        }
      }

      // è³‡è¨ŠæŒ‰éˆ• 

      const infoBtn = document.getElementById("info-btn");
      const modal = document.getElementById("modal");
      const closeX = document.getElementById("modal-close");

      infoBtn.addEventListener("click", () => {
        if (modal.style.display === "flex") {
          modal.style.display = "none";
        } else {
          modal.style.display = "flex";
        }
      });

      closeX.addEventListener("click", () => {
        modal.style.display = "none";
      });

      // å–®ä½åˆ‡æ›

      document.querySelectorAll(".entertain-card").forEach((card) => {
        const toggle = card.querySelector(
          '.toggle-switch input[type="checkbox"]'
        );
        const titles = card.querySelectorAll(".question-title[data-template]");

        if (!toggle || titles.length === 0) return;

        const leftLabel = card
          .querySelector(".toggle-row span:nth-child(1)")
          ?.textContent.trim();
        const rightLabel = card
          .querySelector(".toggle-row span:nth-child(3)")
          ?.textContent.trim();

        function updateTitle() {
          const selectedUnit = toggle.checked ? rightLabel : leftLabel;
          titles.forEach((title) => {
            const template = title.dataset.template;
            title.textContent = template.replace("{unit}", selectedUnit);
          });
        }

        updateTitle();
        toggle.addEventListener("change", updateTitle);
      });

      // æ˜Ÿéš›èŠå¤©å®¤

      const messages = [
        {
          type: "time",
          text: "ä¸Šåˆ 9:30",
          time: 1000,
        },
        {
          text: "ç™»å…¥ä¸­...æ­¡è¿é€²å…¥AIæ™ºæ…§é›²ç«¯ç”Ÿæ´»ï¼ä½ ç¾åœ¨çš„ç”Ÿæ´»æ˜¯24å°æ™‚ä¸Šç¶²ã€AIæ¨è–¦åƒç©¿ç”¨ã€æ‰‹æ©Ÿä¸€å¤©å……ä¸‰æ¬¡é›»çš„è¶…äººé¡æ™‚ä»£ï¼",
          from: "cat",
          time: 2000,
        },
        {
          text: "é€™è£¡æ˜¯...ç¾åœ¨çš„æˆ‘å€‘å°å§ï¼Ÿ",
          from: "user",
          time: 1500,
        },
        {
          text: "æ²’éŒ¯ï¼Œé€™æ­£æ˜¯æˆ‘å€‘çš„ã€Œç¢³ç”Ÿæ´»ã€ä¸»å ´ã€‚å¾ä½ æ‰“é–‹ä¸€æ”¯reelsã€è¿½ä¸€å ´Netflixã€ç”¨AIç”Ÿæˆä¸€å¼µè²“è²“åœ–ï¼ŒèƒŒå¾Œéƒ½æ˜¯å·¨å¤§çš„é›²ç«¯ä¼ºæœå™¨åœ¨é‹è½‰ã€‚",
          from: "cat",
          time: 2500,
        },
        {
          text: "è³‡æ–™ä¸­å¿ƒéœ€è¦å…¨å¹´ç„¡ä¼‘å’Œå†·å»ã€é«˜é »è¨ˆç®—ã€é«˜èƒ½è€—ä¼ºæœå™¨ï¼Œè€Œæ™ºæ…§ç”Ÿæ´»å¸¶ä¾†çš„ä¾¿åˆ©ï¼Œä¹Ÿå¸¶ä¾†å‰æ‰€æœªæœ‰çš„èƒ½æºéœ€æ±‚ã€‚èªªç™½äº†ï¼Œç¾åœ¨æˆ‘å€‘ä¸ç”¨å‡ºé–€ä¹Ÿèƒ½...ç¢³æ’çˆ†è¡¨ï¼",
          from: "cat",
          time: 3000,
        },
        {
          text: "ç¢ºå¯¦ï¼æˆ‘å€‘æ ¹æœ¬ç„¡æ³•æ‹’çµ•ä¾¿åˆ©ï¼ä½†ï¼Œé€™ä¸å°±æ˜¯äººé¡æ¨å‹•ç§‘æŠ€é€²æ­¥çš„ç›®çš„å—...",
          from: "user",
        },
      ];

      const chatContainer = document.getElementById("chatContainer");

      function createMessageElement(message) {
        if (message.type === "time") {
          const timeEl = document.createElement("div");
          timeEl.classList.add("home-story-time-stamp");
          timeEl.textContent = message.text;
          return timeEl;
        }

        const wrapper = document.createElement("div");
        wrapper.classList.add(
          "story-message",
          message.from === "user" ? "story-user-message" : "story-cat-message"
        );

        const avatar = document.createElement("div");
        avatar.classList.add("story-avatar");
        avatar.textContent = message.from === "user" ? "U" : "A";

        const bubble = document.createElement("div");
        bubble.classList.add("story-message-bubble");
        bubble.textContent = message.text;

        wrapper.appendChild(avatar);
        wrapper.appendChild(bubble);
        return wrapper;
      }

    async function playIntroMessages() {
      for (let i = 0; i < messages.length; i++) {
        const el = createMessageElement(messages[i]);
        const messageTime = messages[i].time;
        chatContainer.appendChild(el);
        chatContainer.scrollTop = chatContainer.scrollHeight;
        await new Promise((resolve) => setTimeout(resolve, messageTime));
      }
    }

      window.addEventListener("DOMContentLoaded", playIntroMessages);

      // é¸æ“‡å¨›æ¨‚æ´»å‹•

      function handleFirstSceneNext() {
        // å›ºå®šé †åº
        const fullOrder = [
          "KTV",
          "é›»å½±",
          "å¥èº«æˆ¿",
          "æ—…éŠä½å®¿",
          "å½±éŸ³ä¸²æµ",
          "å®—æ•™ä¿¡ä»°",
        ];

        // éæ¿¾é¸å–çš„é …ç›®ä¸¦ä¾ç…§å›ºå®šé †åºæ’åº
        const sortedActivities = fullOrder.filter((activity) =>
          selectedActivities.includes(activity)
        );

        // æ›´æ–°é™£åˆ—
        selectedActivities.length = 0;
        selectedActivities.push(...sortedActivities);

        if (selectedActivities.length === 0) {
          alert("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹å¨›æ¨‚æ´»å‹•ï¼");
          return;
        }

        const firstScene = activityScenes[selectedActivities[0]];
        goToScene(firstScene);
      }

      const selectedActivities = []; // å„²å­˜é¸å–çš„é …ç›®ï¼Œä¾‹å¦‚ ['KTV', 'é›»å½±']
      const activityScenes = {
        KTV: "scene-entertain-2-1",
        é›»å½±: "scene-entertain-2-2",
        å¥èº«æˆ¿: "scene-entertain-2-3",
        æ—…éŠä½å®¿: "scene-entertain-2-4",
        å½±éŸ³ä¸²æµ: "scene-entertain-2-5",
        å®—æ•™ä¿¡ä»°: "scene-entertain-2-6",
      };

      function toggleActivity(card, activity) {
        const index = selectedActivities.indexOf(activity);

        if (index === -1) {
          selectedActivities.push(activity);
          card.classList.add("selected");
        } else {
          selectedActivities.splice(index, 1);
          card.classList.remove("selected");
        }

        updatePageIndicators();
      }

      // barè·³è½‰é é¢

      function goToScene(targetId) {
        document.getElementById(currentScene).classList.remove("active");
        document.getElementById(targetId).classList.add("active");
        currentScene = targetId;
        updatePageIndicators();
        updateNavButtonsVisibility();
      }

    function updatePageIndicators() {
      const scene = document.getElementById(currentScene);
      const container = scene.querySelector(".dynamic-bar-container");

      if (!container) return;
      container.innerHTML = "";

      // ğŸ‘‰ 1. å…ˆåŠ ä¸Šã€Œé¸æ“‡é ã€çš„ barï¼ˆæ°¸é æ˜¯ç¬¬ä¸€å€‹ï¼‰
      const selectHitArea = document.createElement("div");
      selectHitArea.classList.add("bar-hit-area");

      const selectBar = document.createElement("span");
      selectBar.classList.add("bar");

      // å¦‚æœç¾åœ¨é é¢æ˜¯ scene-entertain-1ï¼Œè¨­å®š active ç‹€æ…‹
      if (currentScene === "scene-entertain-1") {
        selectBar.classList.add("active");
      }

      selectHitArea.appendChild(selectBar);
      selectHitArea.onclick = () => {
        goToScene("scene-entertain-1");
        updateBarActive(0); // ç¬¬ä¸€å€‹ bar æ˜¯ index 0
      };
      container.appendChild(selectHitArea);

      // ğŸ‘‰ 2. ä¾æ“šé¸åˆ°çš„ activity åŠ ä¸Šå°æ‡‰ bar
      selectedActivities.forEach((activity, idx) => {
        const sceneId = activityScenes[activity];
        if (!sceneId) return;

        const hitArea = document.createElement("div");
        hitArea.classList.add("bar-hit-area");

        const bar = document.createElement("span");
        bar.classList.add("bar");

        // æ³¨æ„ï¼šå› ç‚ºç¬¬ä¸€å€‹ bar æ˜¯é¸æ“‡é ï¼Œé€™é‚Šæ˜¯ idx+1
        if (currentScene === sceneId) {
          bar.classList.add("active");
        }

        hitArea.appendChild(bar);

        hitArea.onclick = () => {
          goToScene(sceneId);
          updateBarActive(idx + 1);
        };

        container.appendChild(hitArea);
      });
    }


    function updateNavButtonsVisibility() {
      const sceneEl = document.getElementById(currentScene);

      // å–å¾—æŒ‰éˆ•ï¼ˆç”¨ querySelector æ‰¾ç•¶å‰ scene è£¡çš„æŒ‰éˆ•ï¼‰
      const prevBtn = sceneEl.querySelector(".prev-btn");
      const nextBtn = sceneEl.querySelector(".next-btn");

      // å…¨éƒ¨å…ˆéš±è—
      document.querySelectorAll(".prev-btn, .next-btn").forEach(btn => {
        btn.style.display = "none";
      });

      // é€™å€‹ scene æœ‰çš„æ‰é¡¯ç¤º
      if (prevBtn) prevBtn.style.display = "block";
      if (nextBtn) nextBtn.style.display = "block";
    }


    function updateBarActive(activeIndex) {
      const scene = document.getElementById(currentScene);
      const container = scene.querySelector(".dynamic-bar-container");
      if (!container) return;

      const bars = container.querySelectorAll(".bar-hit-area .bar");
      bars.forEach((bar, idx) => {
        if (idx === activeIndex) {
          bar.classList.add("active");
        } else {
          bar.classList.remove("active");
        }
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      currentScene = "scene-entertain-1";
      updatePageIndicators();   // â† åŠ ä¸Šé€™å€‹
      updateNavButtonsVisibility(); // â† å¦‚æœéœ€è¦æŒ‰éˆ•ä¹ŸåŠ ä¸Š
    });

    function collectUserInputs() {
    const emissionFactors = {
      KTV: {
        æœˆ: 46.584,
        å¹´: 3.882,
      },
      é›»å½±é™¢: {
        æœˆ: 23.394,
        å¹´: 1.95,
      },
      å¥èº«æˆ¿: {
        é€±: 9.351,
        æœˆ: 37.405,
      },
      ç¶²è·¯æµé‡: {
        "GB/æœˆ": 0.123,
      },
      å½±éŸ³ä¸²æµ: {
        "å°æ™‚/å¤©": 1.682,
        "å°æ™‚/é€±": 0.24,
      },
    };

    const results = {};

    selectedActivities.forEach((activity) => {
      const sceneId = activityScenes[activity];
      const scene = document.getElementById(sceneId);
      if (!scene) return;

      let value = 0;
      let unit = "";
      let emission = 0;

      if (activity === "ç¶²è·¯æµé‡") {
        const input = scene.querySelector(".streaming-toggle-card-3 input[type='number']");
        value = parseFloat(input.value) || 0;
        unit = "GB/æœˆ";
        emission = value * emissionFactors["ç¶²è·¯æµé‡"][unit];
      }

      else if (activity === "å½±éŸ³ä¸²æµ") {
        const input = scene.querySelector(".streaming-toggle-card-2 input[type='number']");
        value = parseFloat(input.value) || 0;

        const isWeekly = scene.querySelector(".streaming-toggle-card-1 input[type='checkbox']").checked;
        unit = isWeekly ? "å°æ™‚/é€±" : "å°æ™‚/å¤©";

        emission = value * emissionFactors["å½±éŸ³ä¸²æµ"][unit];
      }

      else if (activity === "å¥èº«æˆ¿") {
        const input = scene.querySelector(".toggle-card-2 input[type='number']");
        value = parseFloat(input.value) || 0;

        const isMonthly = scene.querySelector(".toggle-card-1 input[type='checkbox']").checked;
        unit = isMonthly ? "æœˆ" : "é€±";

        emission = value * emissionFactors["å¥èº«æˆ¿"][unit];
      }

      else {
        const input = scene.querySelector(".toggle-card-2 input[type='number']");
        value = parseFloat(input.value) || 0;

        const isYearly = scene.querySelector(".toggle-card-1 input[type='checkbox']").checked;
        unit = isYearly ? "å¹´" : "æœˆ";

        emission = value * emissionFactors[activity][unit];
      }

      results[activity] = {
        value,
        unit,
        emission: parseFloat(emission.toFixed(3)),
      };
    });

    return results;
  }

    </script>
  </body>
</html>

