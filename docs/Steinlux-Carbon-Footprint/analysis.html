<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>星際碳險</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"></script>
    <style>
      /*—— 自訂字體 ——*/
      @font-face {
        font-family: "GenSenRounded2TW-R";
        src: url("../font/GenSenRounded2TW-R.otf") format("opentype");
        font-weight: normal;
        font-style: normal;
        font-display: swap;
      }

      @media (min-width: 1200px) {
        html {
          font-size: 18px;
        }
      }

      @media (max-width: 480px) {
        html {
          font-size: 14px;
        }
      }

      html {
        font-family: "GenSenRounded2TW-R", sans-serif;
      }

      body {
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 100vh;
      }

      p {
        width: 100%;
        margin: 0.25rem;
      }

      .scroll-container {
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        scroll-snap-type: y mandatory;
        scroll-behavior: smooth;
        z-index: 999;
      }

      /*—— 場景容器 ——*/
      .scene {
        position: relative;
        width: 100vw;
        height: 100vh;
        scroll-snap-align: start;
        z-index: 999;
      }

      .scene-1 {
        background: url("images/0813修01.jpg") no-repeat 0 0;
        background-size: 100% 200%;
      }

      .scene-2 {
        background: url("images/0813修01.jpg") no-repeat 0 -100vh;
        background-size: 100% 200%;
      }

      @media (max-width: 1024px) {
      .scene-1 {
        background: url("images/0813修02.jpg") no-repeat 0 0;
        background-size: 100% 200%;
      }

      .scene-2 {
        background: url("images/0813修02.jpg") no-repeat 0 -100vh;
        background-size: 100% 200%;
      }
      }

      @media (max-width: 600px) {
      .scene-1 {
        background: url("images/0813修03.jpg") no-repeat 0 0;
        background-size: 100% 200%;
      }

      .scene-2 {
        height: 0;
      }
      }

      .scene-1 .sealevel-container {
        display: flex;
        flex-direction: column;
        position: fixed;
        min-width: max-content;
        min-height: max-content;
        font-size: 1.5rem;
        letter-spacing: 8px;
        color: #F5F5F5;
        top: 5%;
        right: 72.5%;
        translate:(-50%, -50%); ;
        z-index: 2;
        opacity: 1;
      }

      .scene-1 .sealevel-container iframe {
        margin-top: 0.5rem;
        border-radius: 1.25rem;
      }

      .scene-1 .carbon-footprint-emissions-container {
        display: flex;
        flex-direction: column;
        position: fixed;
        width: 450px;
        font-size: 1.5rem;
        letter-spacing: 8px;
        color: #F5F5F5;
        top: 5%;
        right: 3.25%;
        translate:(-50%, -50%); ;
        z-index: 2;
        opacity: 1;
      }

      .scene-1 #carbon-footprint-emissions-value {
        font-size: 1.75rem;
        color: #6D808F;
      }

      .scene-1 .emissions-unit {
        font-size: 0.8rem;
        letter-spacing: 4px;
      }

      .scene-1 .carbon-footprint-emissions-neutrality {
        width: 65%;
        font-size: 0.8rem;
        text-align: justify;
        letter-spacing: 4px;
        line-height: 2;
      }

      .scene-1 .carbon-footprint-temperature-container {
        display: flex;
        flex-direction: column;
        position: fixed;
        width: 450px;
        font-size: 1.5rem;
        letter-spacing: 8px;
        color: #F5F5F5;
        top: 38%;
        right: 5%;
        translate:(-50%, -50%); ;
        z-index: 2;
        opacity: 1;
      }

      .scene-1 .temperature-text {
        text-align: right;
      }

      .scene-1 #carbon-footprint-temperature-value {
        color: #C00000;
      }

      .scene-1 .polarbear-container {
        display: flex;
        flex-direction: column;
        position: fixed;
        width: 300px;
        font-size: 0.75rem;
        letter-spacing: 8px;
        color: #F5F5F5;
        top: 57.5%;
        right: 5%;
        translate:(-50%, -50%); ;
        z-index: 2;
        opacity: 1;
      }

      .scene-1 .polarbear-text {
        font-size: 0.75rem;
      }

      @media (max-width: 900px) {
        .scene-1 {
          display: flex;
          flex-direction: column;
          align-items: center;   /* 水平置中 */
          justify-content: flex-start; /* 從上往下排列 */
        }

        .scene-1 .sealevel-container,
        .scene-1 .carbon-footprint-emissions-container,
        .scene-1 .carbon-footprint-temperature-container,
        .scene-1 .polarbear-container {
          position: static;   /* 拿掉 fixed 讓它們跟隨 flex 排列 */
          width: 90%;        /* 自動縮排，避免超出螢幕 */
          max-width: 450px;  /* 保持原本容器寬度限制 */
          margin: 1rem 0;    /* 間距 */
          text-align: center; /* 文字置中 */
          translate: none;   /* 移除 translate */
        }
      }

      .scene-2 .carbon-footprint-status-container {
        position: fixed;
        top: 5%;
        left: 5%;
        translate:(-50%, -50%);
        width: 40vw;
        height: 90vh;
        background: rgba(255, 255, 255, 0.4);
        border-radius: 72px;
        opacity: 0;
        -webkit-box-shadow:
        inset -7px -5.25px 2px -6.5px rgba(255, 255, 255), 
        inset 7px 5.25px 2px -6.5px rgb(255, 255, 255),
        inset -2.25px -8px 2px -6.75px rgb(255, 255, 255), 
        inset 2.25px 8px 2px -6.75px rgb(255, 255, 255),
        4px 8px 32px 0px rgba(110, 110, 110, 0.25);
        box-shadow:
        inset -7px -5.25px 2px -6.5px rgba(255, 255, 255), 
        inset 7px 5.25px 2px -6.5px rgb(255, 255, 255),
        inset -2.25px -8px 2px -6.75px rgb(255, 255, 255), 
        inset 2.25px 8px 2px -6.75px rgb(255, 255, 255),
        4px 8px 32px 0px rgba(110, 110, 110, 0.25);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }


      /* 提示滑鼠 */
     .scroll-mouse {
      position: fixed;
      bottom: 5%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 5;
      width: 18px;
      height: 26px;
      cursor: pointer;
    }

    /* 動畫邊框 */
    .border-anim {
      stroke-dasharray: 90;
      stroke-dashoffset: 90;
      cursor: pointer;
      transition: stroke-dashoffset 1s linear;
    }
    
    .mouse-line {
      position: absolute;
      width: 0.05rem;
      height: 0.4rem;
      background-color: #fff;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      transition: translateY 0.3s linear;
      animation: none;
    }

    .scroll-mouse:hover .mouse-line {
      animation: mouseLineAnim 0.6s forwards;
    }

    .scroll-mouse:not(:hover) .border-anim {
      stroke-dashoffset: 90;
    }

    .scroll-mouse:hover .border-anim {
      stroke-dashoffset: 00;
    }

    </style>
  </head>
  <body>
    <div class="scroll-container">
      <section class="scene scene-1">
        <div class="sealevel-container">
          <p>2100年，預計海平面<br>​將上升......</p>
          <iframe allow="fullscreen 'none'" frameBorder="0" src="https://coastal.climatecentral.org/embed/map/11/121.4115/25.1141/?theme=warming&map_type=decadal_slr&basemap=roadmap&contiguous=true&elevation_model=best_available&esl_model=ipcc_2021&percentile=p50&slr_year=2100&temperature_rise=3.1&temperature_unit=C" width="100%" height="200" title="Climate Central | Land projected to be below tideline in 2100"></iframe>
        </div>

        <div class="carbon-footprint-emissions-container">
          <p class="emissions-text">您過去一年的碳足跡排放是</p>
          <p>
            <span id="carbon-footprint-emissions-value">12.437</span>
            <span>公噸<span class="emissions-unit">二氧化碳當量(tCO2e)</span></span>
            
          </p>
          <p class="carbon-footprint-emissions-neutrality">為了中和您的排放，必須復育大約 17,274m2的自然再生林地。這大約與1.3座台北大巨蛋相同！</p>
        </div>

        <div class="carbon-footprint-temperature-container">
          <p class="temperature-text">地球持續升溫</p>
          <p class="temperature-text">本世紀末將達
            <span id="carbon-footprint-temperature-value">3.7℃</span>
          </p>
        </div>

        <div class="polarbear-container">
          <img src="./images/bg-fashion.webp" alt="">
          <p class="polarbear-text">這將導致我們可愛的北極熊不再有冷氣吹...</p>
        </div>
        
        <div class="scroll-mouse">
          <svg class="mouse-svg" viewBox="0 0 18 26" xmlns="http://www.w3.org/2000/svg">
            <!-- 白色底框 -->
            <rect x="1" y="1" width="16" height="24" rx="8" stroke="#cccccc" stroke-width="1" fill="none" />
            <!-- 動畫邊框 -->
            <rect class="border-anim" x="1" y="1" width="16" height="24" rx="8" stroke="#ffffff" stroke-width="1" fill="none" />
          </svg>
          <div class="mouse-line"></div>
        </div>
      </section>
      <section class="scene scene-2">

        <div class="carbon-footprint-status-container">
        </div>

        <div class="scroll-mouse">
          <svg class="mouse-svg" viewBox="0 0 18 26" xmlns="http://www.w3.org/2000/svg">
            <!-- 白色底框 -->
            <rect x="1" y="1" width="16" height="24" rx="8" stroke="#cccccc" stroke-width="1" fill="none" />
            <!-- 動畫邊框 -->
            <rect class="border-anim" x="1" y="1" width="16" height="24" rx="8" stroke="#ffffff" stroke-width="1" fill="none" />
          </svg>
          <div class="mouse-line"></div>
        </div>
      </section>
    </div>

<script>
document.addEventListener("DOMContentLoaded", () => {

// 第一幕直接開始

// 第二幕使用 IntersectionObserver 等進入畫面後才執行

const observer = new IntersectionObserver(
  (entries, observer) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        // 動畫時間是 1 秒，這裡延遲 1000ms 再打字
        setTimeout(() => {
        }, 1000);
        observer.unobserve(entry.target);
      }
    });
  },
  {
    threshold: 0.6,
  }
);

observer.observe(document.querySelector(".scene-2"));

    function isMobile() {
    return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }

    function preventTouchScroll(e) {
      e.preventDefault();
    }

    if (isMobile()) {
      document.body.addEventListener("touchmove", preventTouchScroll, { passive: false });
    }

    // 函數：暫時禁止滾動
    function disableScroll() {
      document.body.style.overflow = "hidden";
    }

    // 函數：恢復滾動
    function enableScroll() {
      document.body.style.overflow = "";
    }
    
    // 判斷是否為行動裝置
  function isMobile() {
    return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
  }
  const isMobileLayout = window.innerWidth <= 768;

  function preventTouchScroll(e) {
    e.preventDefault();
  }
  if (isMobile()) {
    document.body.addEventListener("touchmove", preventTouchScroll, { passive: false });
  }

  function disableScroll() {
    document.body.style.overflow = "hidden";
    container.style.overflow = "hidden";
  }

  function enableScroll() {
    document.body.style.overflow = "";
    container.style.overflow = "";
  }

  if (isMobile()) {
  document.body.addEventListener("touchmove", preventTouchScroll, { passive: false });

  let touchStartY = 0;
  let touchEndY = 0;

  document.body.addEventListener("touchstart", (e) => {
    touchStartY = e.touches[0].clientY;
  });

  document.body.addEventListener("touchend", (e) => {
    touchEndY = e.changedTouches[0].clientY;
    const deltaY = touchEndY - touchStartY;

    // 向上滑（往下進入第二幕）
    if (deltaY < -50) { // 閾值 50px 避免誤觸
      goToSecondScene();
    }
    // 向下滑（往上回第一幕）
    else if (deltaY > 50) {
      goToFirstScene();
    }
  });
}

  const container = document.querySelector(".scroll-container");
  let isScrolling = false;
  const cooldownTime = 3000;
  let lastScrollTime = 0;

  // 切到第二幕
  function goToSecondScene() {
    if (isScrolling) return;
    const vh = window.innerHeight;
    isScrolling = true;
    lastScrollTime = Date.now();
    disableScroll();

    gsap.to(container, {
      scrollTo: { y: vh },
      duration: 2,
      ease: "power2.out",
      onStart: () => {
        gsap.to(".scene-1 .sealevel-container", { opacity: 0, duration: 0.5 });
        gsap.to(".scene-1 .carbon-footprint-emissions-container", { opacity: 0, duration: 0.5 });
        gsap.to(".scene-1 .carbon-footprint-temperature-container", { opacity: 0, duration: 0.5 });
        gsap.to(".scene-1 .polarbear-container", { opacity: 0, duration: 0.25 });
        gsap.to(".scene-2 .carbon-footprint-status-container", { delay: 0.5, opacity: 1, duration: 1.5 })
      },
      onComplete: () => {
        isScrolling = false;
        enableScroll();
      },
    });
  }

  // 切回第一幕
  function goToFirstScene() {
    const vh = window.innerHeight;
    isScrolling = true;
    lastScrollTime = Date.now();
    disableScroll();

    gsap.to(container, {
      scrollTo: { y: 0 },
      duration: 2,
      ease: "power2.out",
      onStart: () => {
        gsap.to(".scene-1 .sealevel-container", { delay: 0.5, opacity: 1, duration: 1.5 });
        gsap.to(".scene-1 .carbon-footprint-emissions-container", { delay: 0.5, opacity: 1, duration: 1.5 });
        gsap.to(".scene-1 .carbon-footprint-temperature-container", { delay: 0.5, opacity: 1, duration: 1.5 });
        gsap.to(".scene-1 .polarbear-container", { delay: 0.75, opacity: 1, duration: 1.5 });
        gsap.to(".scene-2 .carbon-footprint-status-container", { opacity: 0, duration: 0.5 })
      },
      onComplete: () => {
        isScrolling = false;
        enableScroll();
      },
    });
  }

  // 點擊滑鼠圖示切換場景
  const scrollMouse1 = document.querySelector(".scene-1 .scroll-mouse");
  if (scrollMouse1) scrollMouse1.addEventListener("click", goToSecondScene);

  const scrollMouse2 = document.querySelector(".scene-2 .scroll-mouse");
  if (scrollMouse2) scrollMouse2.addEventListener("click", goToFirstScene);

  window.goToSecondScene = goToSecondScene;

  // 滑鼠滾輪切換場景
  container.addEventListener(
    "wheel",
    (e) => {
      const now = Date.now();
      if (now - lastScrollTime < cooldownTime || isScrolling) {
        e.preventDefault();
        return;
      }

      const deltaY = e.deltaY;
      const scrollTop = container.scrollTop;
      const vh = window.innerHeight;

      // 往下滾進入第二幕
      if (deltaY > 0 && scrollTop < vh / 2) {
        e.preventDefault();
        goToSecondScene();
      }
      // 往上滾回到第一幕
      else if (deltaY < 0 && scrollTop > vh / 1.5 && scrollTop < vh * 1.5) {
        e.preventDefault();
        goToFirstScene();
      }
    },
    { passive: false }
  );
});
</script>

  </body>
</html>
