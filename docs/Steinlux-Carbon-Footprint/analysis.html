<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>星際碳險</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"></script>
    <style>
      /*—— 自訂字體 ——*/
      @font-face {
        font-family: "SweiXDPearlCJKtc-Medium";
        src: url("font/SweiXDPearlCJKtc-Medium.ttf") format("truetype");
        font-weight: normal;
        font-style: normal;
        font-display: swap;
      }
      @font-face {
        font-family: "SweiXDPearlCJKtc-DemiLight";
        src: url("font/SweiXDPearlCJKtc-DemiLight.ttf") format("truetype");
        font-weight: normal;
        font-style: normal;
        font-display: swap;
      }

      @media (min-width: 1200px) {
        html {
          font-size: 18px;
        }
      }

      @media (max-width: 480px) {
        html {
          font-size: 14px;
        }
      }

      /*—— 全域設定 ——*/
      body {
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 100vh;
      }

      .scroll-container {
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        scroll-snap-type: y mandatory;
        scroll-behavior: smooth;
        z-index: 999;
      }

      /*—— 場景容器 ——*/
      .scene {
        position: relative;
        width: 100vw;
        height: 100vh;
        scroll-snap-align: start;
        z-index: 999;
      }

      .scene-1 {
        background: url("images/分析頁背景.png") no-repeat 0 0;
        background-size: 100% 200%;
      }

      .scene-2 {
        background: url("images/分析頁背景.png") no-repeat 0 -100vh;
        background-size: 100% 200%;
      }

      /* 提示滑鼠 */
     .scroll-mouse {
      position: fixed;
      bottom: 5%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 5;
      width: 18px;
      height: 26px;
      cursor: pointer;
    }

    /* 動畫邊框 */
    .border-anim {
      stroke-dasharray: 90;
      stroke-dashoffset: 90;
      cursor: pointer;
      transition: stroke-dashoffset 1s linear;
    }
    
    .mouse-line {
      position: absolute;
      width: 0.05rem;
      height: 0.4rem;
      background-color: #fff;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      transition: translateY 0.3s linear;
      animation: none;
    }

    .scroll-mouse:hover .mouse-line {
      animation: mouseLineAnim 0.6s forwards;
    }

    .scroll-mouse:not(:hover) .border-anim {
      stroke-dashoffset: 90;
    }

    .scroll-mouse:hover .border-anim {
      stroke-dashoffset: 00;
    }

    </style>
  </head>
  <body>
    <div class="scroll-container">
      <section class="scene scene-1">
        <div class="scroll-mouse">
          <svg class="mouse-svg" viewBox="0 0 18 26" xmlns="http://www.w3.org/2000/svg">
            <!-- 白色底框 -->
            <rect x="1" y="1" width="16" height="24" rx="8" stroke="#cccccc" stroke-width="1" fill="none" />
            <!-- 動畫邊框 -->
            <rect class="border-anim" x="1" y="1" width="16" height="24" rx="8" stroke="#ffffff" stroke-width="1" fill="none" />
          </svg>
          <div class="mouse-line"></div>
        </div>
      </section>
      <section class="scene scene-2">
        <div class="scroll-mouse">
          <svg class="mouse-svg" viewBox="0 0 18 26" xmlns="http://www.w3.org/2000/svg">
            <!-- 白色底框 -->
            <rect x="1" y="1" width="16" height="24" rx="8" stroke="#cccccc" stroke-width="1" fill="none" />
            <!-- 動畫邊框 -->
            <rect class="border-anim" x="1" y="1" width="16" height="24" rx="8" stroke="#ffffff" stroke-width="1" fill="none" />
          </svg>
          <div class="mouse-line"></div>
        </div>
      </section>
    </div>

<script>
document.addEventListener("DOMContentLoaded", () => {

// 第一幕直接開始

// 第二幕使用 IntersectionObserver 等進入畫面後才執行

const observer = new IntersectionObserver(
  (entries, observer) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        // 動畫時間是 1 秒，這裡延遲 1000ms 再打字
        setTimeout(() => {
        }, 1000);
        observer.unobserve(entry.target);
      }
    });
  },
  {
    threshold: 0.6,
  }
);

observer.observe(document.querySelector(".scene-2"));

    // 函數：暫時禁止滾動
    function disableScroll() {
      document.body.style.overflow = "hidden";
    }

    // 函數：恢復滾動
    function enableScroll() {
      document.body.style.overflow = "";
    }

    const container = document.querySelector(".scroll-container");
    let isScrolling = false;
    const cooldownTime = 1500;
    let lastScrollTime = 0;
    
  // 添加小老鼠點擊事件監聽器
  document.querySelectorAll('.scroll-mouse').forEach((mouse) => {
    mouse.addEventListener('click', goToSecondScene);
  });

  // 小老鼠點擊滑動到第二幕的函數
  function goToSecondScene() {
    // 防止重複點擊
    if (isScrolling) return;
    
    const vh = window.innerHeight;
    
    isScrolling = true;
    lastScrollTime = Date.now();
    disableScroll();

    // 滑動到第二幕，使用與滾輪相同的動畫
    gsap.to(container, {
      scrollTo: { y: vh },
      duration: 2,
      ease: "power2.out",
      onStart: () => {
      gsap.to(
      ".scene-1 .scroll-mouse",
      {
        opacity: 0,
        duration: 2
      });
      gsap.to(
      ".scene-2 .scroll-mouse",
      {
        opacity: 0,
        duration: 2
      });
      },
      onComplete: () => {
        isScrolling = false;
        enableScroll();
      },
    });
  }

  // 也讓函數在全域可用（如果你想保留HTML中的onclick）
  window.goToSecondScene = goToSecondScene;

    container.addEventListener(
      "wheel",
      (e) => {
        const now = Date.now();

        // ✅ 冷卻中 or 動畫中：禁止預設行為，並跳出
        if (now - lastScrollTime < cooldownTime || isScrolling) {
          e.preventDefault();
          return;
        }

        const deltaY = e.deltaY;
        const scrollTop = container.scrollTop;
        const vh = window.innerHeight;

        if (deltaY > 0 && scrollTop < vh / 2) {
          e.preventDefault();
          isScrolling = true;
          lastScrollTime = now;
          disableScroll();

        // 進入第二幕
        gsap.to(container, {
          scrollTo: { y: vh },
          duration: 2,
          ease: "power2.out",
          onStart: () => {
          gsap.to(
          ".scene-1 .scroll-mouse",
          {
            opacity: 0,
            duration: 2
          });
          gsap.to(
          ".scene-2 .scroll-mouse",
          {
            opacity: 0,
            duration: 2
          });
          
          },
          onComplete: () => {
            isScrolling = false;
            enableScroll();
          },
        });
        } 
        else if (
          deltaY < 0 &&
          scrollTop > vh / 1.5 &&
          scrollTop < vh * 1.5
        ) {
          e.preventDefault();
          isScrolling = true;
          lastScrollTime = now;
          disableScroll();

        // 回到第一幕
        gsap.to(container, {
          scrollTo: { y: 0 },
          duration: 2,
          ease: "power2.out",
          onStart: () => {
          gsap.to(
          ".scene-1 .scroll-mouse",
          {
            opacity: 1,
            duration: 2
          });
                    gsap.to(
          ".scene-2 .scroll-mouse",
          {
            opacity: 1,
            duration: 2
          });

          },
          onComplete: () => {
            isScrolling = false;
            enableScroll();
          },
        });
                }
              },
              { passive: false }
            );
          }
        )
</script>

  </body>
</html>
